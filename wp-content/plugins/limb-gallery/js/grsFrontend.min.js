var grsHmTouchEvents=angular.module("grsHmTouchEvents",[]),grsHmGestures=["hmHold:hold","hmTap:tap","hmDoubletap:doubletap","hmDrag:drag","hmDragstart:dragstart","hmDragend:dragend","hmDragup:dragup","hmDragdown:dragdown","hmDragleft:dragleft","hmDragright:dragright","hmSwipe:swipe","hmSwipeup:swipeup","hmSwipedown:swipedown","hmSwipeleft:swipeleft","hmSwiperight:swiperight","hmTransformstart:transformstart","hmTransform:transform","hmTransformend:transformend","hmRotate:rotate","hmPinch:pinch","hmPinchin:pinchin","hmPinchout:pinchout","hmTouch:touch","hmRelease:release"];angular.forEach(grsHmGestures,function(e){var t=e.split(":"),o=t[0],s=t[1];grsHmTouchEvents.directive(o,["$parse",function(r){return{scope:!0,link:function(t,e,a){var i,n;return i=r(a[o]),(n=r(a.hmOptions)(t,{}))&&n.group?t.hammer=t.hammer||Hammer(e[0],n):t.hammer=Hammer(e[0],n),t.hammer.on(s,function(e){return t.$apply(function(){return i(t,{$event:e})})})}}}])});var html=document.getElementsByTagName("html")[0],grsApp=angular.module("grsApp",["grsHmTouchEvents"]).config(["$locationProvider",function(e){e.hashPrefix("!")}]);function insertCss(e,t){var a=document.head,i=document.createElement("link");"0"!==e.theme&&(i.grs=t,i.type="text/css",i.rel="stylesheet",i.href=grsPluginUrl+"/css/grsTemplate"+e.theme+".css?lastmodified="+e.themeLastModDate,a.appendChild(i),i.onload=function(){var e=document.querySelector("#grsGal"+this.grs+" > div"),t=angular.element(e).scope();t.params.cssReady=!0,t.$$phase||t.$apply()})}angular.element(document).ready(function(){jQuery(".woocommerce").attr("ng-non-bindable","");var e=document.createElement("div"),t=document.createElement("grs-popup");e.setAttribute("ng-controller","grsPopupC"),t.setAttribute("resize","resize"),e.appendChild(t),document.body.appendChild(e),angular.bootstrap(html,["grsApp"])}),grsApp.directive("imageOnload",["GrsService",function(e){return{restrict:"A",link:function(e,t,a){t.bind("load",function(){e.$apply(a.imageOnload)})}}}]),grsApp.directive("backImg",["GrsService",function(n){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.backImg;n.log(i),i=i.replace(/'/g,"\\'"),t.css({"background-image":"url('"+i+"')"})}}}]),grsApp.directive("ifrSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.ifrSrc;i=i.replace(/'/g,"\\'"),t.attr("src",i)}}}]),grsApp.directive("vgSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.vgSrc;i=i.replace(/'/g,"\\'"),t.attr("src",i)}}}]),grsApp.directive("resize",["$window","GrsService",function(a,e){return{link:function(t){function e(e){t.$broadcast("resize::resize")}angular.element(a).on("resize",e),t.$on("$destroy",function(){angular.element(a).off("resize",e)})}}}]),grsApp.directive("scroll",["$window","GrsService",function(a,e){return{link:function(t){function e(e){t.$broadcast("scroll::scroll",5022)}angular.element(a).on("scroll",e),t.$on("$destroy",function(){angular.element(a).off("scroll",e)})}}}]),grsApp.directive("postComm",["GrsService",function(e){return function(t,e,a){e.bind("keydown keypress",function(e){13===e.which&&e.shiftKey||13===e.which&&(e.preventDefault(),t.$apply(function(){t.postIc()}))})}}]),grsApp.service("GrsService",["$log","$window","$sce",function(t,a,i){this.mode="pro",this.wpUploaderUrl=grsWpUploaderUrl,this.uploaderUrl=grsUploaderUrl,this.shareUrl=grsShareUrl,this.pluginUrl=grsPluginUrl,this.pluginVer=grsPluginVer,this.config=grsConfig,this.imagesDir=this.pluginUrl+"/images/",this.settings={},this.settingsReady=!1,this.effectsJsonUrl=i.trustAsResourceUrl(this.pluginUrl+"/frontend/views/grsEffects.json?ver="+this.pluginVer),this.getViewsTemplateUrl=function(e){return i.trustAsResourceUrl(this.pluginUrl+"/frontend/views/"+e+".html?ver="+this.pluginVer)},this.popup={grs:0,show:!1,shatts:{},theme:{},first:!0,items:[],pI:[],cP:0,pC:0,tC:0,lC:0,index:0},this.setPopObj=function(e){if(this.popup.grs=e.grs,this.popup.gallId=e.gallId,this.popup.shatts=e.shatts,this.popup.theme=e.theme,this.popup.orderby=e.orderby,this.popup.ordering=e.ordering,this.popup.items=e.items,this.popup.cP=e.cP,this.popup.pC=e.pC,this.popup.tC=e.tC,this.popup.lC=e.lC,this.popup.index=e.index,0!=e.pC)for(var t=0;t<e.pC;t++)void 0!==e.pI[t]&&(this.popup.pI[t]=e.pI[t]);else this.popup.pI=[];this.log(e),this.popup.show=angular.copy(e.show)},this.setSettings=function(e){this.settings.collapseNavClicks=parseInt(e.collapseNavClicks),this.settings.fmImMoveCount=parseInt(e.fmImMoveCount),this.settings.filmImMoveCount=parseInt(e.filmImMoveCount),this.settings.showVmTitle=parseInt(e.showVmTitle),this.settings.showYtTitle=parseInt(e.showYtTitle),this.settings.hideNavButton=parseInt(e.hideNavButton),this.settings.closeLbOnSide=parseInt(e.closeLbOnSide),this.settings.openCommTrig=parseInt(e.openCommTrig),this.settings.showTitleDescTrig=parseInt(e.showTitleDescTrig),this.settings.default=parseInt(e.default),this.settings.clicksCount=parseInt(e.clicksCount)},this.grsShTC=function(e,t){return"always"===e||"onhover"===e&&"mask"!==t},this.grsShMC=function(e,t){return"mask"===t&&"onhover"===e},this.grsOnhv=function(e){return"onhover"===e},this.log=function(e){"dev"===this.mode&&t.log(e)},this.getImageVer=function(e,t,a){var i="thumbnail"===a?2:1;return e=parseInt(e),t=parseInt(t),e<=400/i&&t<=400/i?"thumbnail/":e<=800/i&&t<=800/i?"medium/":e<=1500/i&&t<=1500/i?"large/":e<=2e3/i&&t<=2e3/i?"extralarge/":""},this.getImageSource=function(e,t){return this["itemSource_"+e.embed](e,t)},this.itemSource_=function(e,t){var a=this.getImageVer(e.thumbWidth,e.thumbHeight,t);return this.uploaderUrl+e.path+a+e.name+e.type},this.itemSource_instagram=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),n="thumbnail"===t?2:1;return"video"===e.type||a<=300/n&&i<=300/n?e.thumb_url:e.path},this.itemSource_youtube=function(e){return e.thumb_url},this.itemSource_vimeo=function(e){return e.thumb_url},this.itemSource_flickr=function(e,t){var a=parseInt(e.thumbWidth),i=parseInt(e.thumbHeight),n="thumbnail"===t?2:1;return a<=400/n&&i<=400/n?e.thumb_url:e.path},this.itemSource_wp=function(e,t){var a=this.getWPImageSizes(e);return this.wpUploaderUrl+e.path+e.name+this.getImageVerWp(parseInt(e.thumbWidth),parseInt(e.thumbHeight),a,t)+e.type},this.getWPImageSizes=function(e){var t=parseInt(e.width),a=parseInt(e.height),i=e.wp_sizes;if(null===i)return{medium:300<t||300<a?this.getRightSizeUrlForWp(300,t,a):"",large:1024<t||1024<a?this.getRightSizeUrlForWp(1024,t,a):"",full:""};e.wp_sizes="object"!=typeof i?JSON.parse(i):i;var n=void 0!==(i=e.wp_sizes).large?"-"+i.large.width+"x"+i.large.height:"";return{medium:void 0!==i.medium?"-"+i.medium.width+"x"+i.medium.height:n,large:n,full:""}},this.getImageVerWp=function(e,t,a,i){var n="thumbnail"===i?2:1;return e<=400/n&&t<=400/n?a.medium:e<=800/n&&t<=800/n?a.large:a.full},this.getLightboxWPimageSize=function(e,t,a,i){var n=this.getWPImageSizes(e);return this.getImageVerWp(parseInt(t),parseInt(a),n,i)},this.getRightSizeUrlForWp=function(e,t,a){return a<t?"-"+e+"x"+Math.round(e*a/t):"-"+Math.round(e*t/a)+"x"+e},this.shVIc=function(e){var t=e.type;return"video"===t||"link"===t},this.link=function(e,t){a.open(this["link_"+e.embed](e),t)},this.link_=function(e){return""===e.link?this.uploaderUrl+e.path+e.name+e.type:e.link},this.link_wp=function(e){return""===e.link?this.wpUploaderUrl+e.path+e.name+e.type:e.link},this.link_youtube=function(e){return""===e.link?e.path:e.link},this.link_instagram=function(e){return this.link_youtube(e)},this.link_flickr=function(e){return this.link_youtube(e)},this.link_vimeo=function(e){return this.link_youtube(e)},this.toUpperCaseFl=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},this.getWidthHeightForFmResize=function(e,t,a){var i={};return a<t?(i.height=Math.round(e/Math.round(t/a)),i.width=e):(i.width=Math.round(e/Math.round(a/t)),i.height=e),i},this.getTrans=function(e){return void 0!==frontTransObj[e]?frontTransObj[e]:e}}]),grsApp.controller("grsPopupC",["$scope","$filter","$log","GrsService","GrsFactory",function(e,t,a,i,n){n.getSettings().then(function(e){angular.isUndefined(e.data.success)?i.log("Error , try to get settings."):(i.setSettings(e.data.success),i.settingsReady=!0)},function(e){i.log(e)})}]),grsApp.directive("grsPopup",["$filter","GrsFactory","GrsService","$window","$timeout","$location",function(e,g,f,h,i,n){return{restrict:"E",transclude:!0,scope:!1,templateUrl:f.getViewsTemplateUrl("grsPopup"),link:function(E,e,t){if(E.options={show:f.popup.show},E.options.enterPopup=function(){return f.log(1111111114444),f.log(E.options.show),f.log(4444444441111),f.log(E.options.effectsLoaded),E.options.show&&E.options.effectsLoaded},E.options.showPopup=function(){return E.view.ready=E.options.commContloaded&&E.options.filmContLoaded,E.view.ready},E.params={grs:0,gallId:f.popup.gallId,shatts:f.popup.shatts,theme:f.popup.theme},E.psImg={},f.config.effects)g.getEffects().then(function(e){E.grsEffects=e.data,E.options.show&&E.setEffect(E.params.shatts.lightboxeffect),E.options.effectsLoaded=!0,E.$$phase||E.$apply()},function(e){f.log(e)});else{var a={noEffect:{}};a.noEffect.effects={},a.noEffect.effects.no={},a.noEffect.doEffect="grsNoEffect",a.noCutting={},a.noCutting.effects={},a.noCutting.effects.fade={},a.noCutting.effects.fade.in="grsFadeIn grsAnDur inAnimationEnd",a.noCutting.effects.fade.out="grsFadeOut grsAnDur outAnimationEnd",a.noCutting.doEffect="grsNoCuting",E.grsEffects=a,E.options.effectsLoaded=!0}E.view={cImIn:0,effect:{},mainAnimationEnd:!0,cImInG:-1,grsCC:[],isFS:!1,shInf:!0,enAp:!1,isFSSmart:!1,active:"",actImg:"",captcha:"",comments:{},isOCC:!0,contButtOp:!0,filmView:f.getViewsTemplateUrl("grsFilmstrip"),commView:f.getViewsTemplateUrl("grsComments")},E.effectsTiming={msForEff:["550","570","590","520","550","870","890","810","830","850","1070","1090","1010","1030","1050","1270","1290","1210","1230","1250","1470","1490","1410","1430","1550","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570"],msForEffHor:["500","600","700","800","900","1000","1100","1200","1300","1400","1500","1600"]},E.browser={pfx:["webkit","moz","ms","o",""],name:""},E.checkBrowser=function(){var e=navigator.userAgent;if(-1!=e.indexOf("Firefox"))E.browser.name="Firefox";else if(-1!=e.indexOf("OPR"))E.browser.name="Opera";else if(-1!=e.indexOf("Edge"))E.browser.name="Edge";else if(-1!=e.indexOf("Safari")){var t=/Google Inc/.test(navigator.vendor),a=/Apple Computer/.test(navigator.vendor);t?E.browser.name="Chrome":a&&(E.browser.name="Safari")}else E.browser.name="Explorer"},E.checkBrowser(),E.items=[],E.$watch(function(){return f.popup.show},function(e,t){f.log(321321),E.options.show=e,E.params.grs=f.popup.grs,E.params.gallId=f.popup.gallId,E.params.shatts=f.popup.shatts,E.params.theme=f.popup.theme,E.params.orderby=f.popup.orderby,E.params.ordering=f.popup.ordering,E.items=f.popup.items,E.view.pI=f.popup.pI,E.view.cP=f.popup.cP,E.view.pC=f.popup.pC,E.view.tC=f.popup.tC,E.view.lC=f.popup.lC,E.view.cImIn=f.popup.index,E.view.noEffect="no"===E.params.shatts.lightboxeffect,E.view.mainAnimationEnd=!0,E.view.loading=!1,E.view.cloading=!1,E.view.outAnimationEnd=!0,E.view.inAnimationEnd=!0,E.view.active="",E.view.actImg="",E.view.grsCC=[],E.view.comments={},E.view.isOCC="1"===E.params.shatts.lightboxcomment&&f.settings.openCommTrig,E.view.emptyName=!1,E.view.invalidMail=!1,E.view.emptyComment=!1,E.view.emptyCaptcha=!1,E.view.contButtOp=!0,E.view.isFSSmart=!1,E.view.actImgId=0,E.view.isFS=!1,E.view.ready=!1,E.view.shInf=f.settings.showTitleDescTrig,E.view.enAp=!1,E.view.apInt=1e3*parseInt(E.params.shatts.lightboxapin),E.options.commContloaded=!(f.config.comments&&"1"===E.params.shatts.lightboxcomment),E.options.filmContLoaded=!(f.config.filmstrip&&"1"===E.params.shatts.lightboxfilmstrip);var a=angular.isString(E.view.cImIn)&&-1!==E.view.cImIn.indexOf("hash-")?E.view.cImIn:f.popup.cP*E.params.shatts.imagesperpage+E.view.cImIn;if(angular.isUndefined(E.view.cachCmmAct)||delete E.view.cachCmmAct,!E.options.show)return delete E.view.firstIn,E.view.cImInG=-1,void(E.view.setAutoplay&&i.cancel(E.view.setAutoplay));E.setViewParamsByRes(),E.setEffect(E.params.shatts.lightboxeffect),E.setItem(a),E.getItems(a)},!0),E.$watch("view.ready",function(){E.view.ready&&E.options.show&&jQuery("html, body").addClass("grsPopupParents")},!0),E.getItems=function(r){var o=[];if("numbers"===E.params.shatts.pagination){for(var e=0;e<E.view.pC;e++)if(angular.isUndefined(E.view.pI[e])){var t={from:e,count:E.params.shatts.imagesperpage};o.push(t)}}else if(E.view.pI[0].length!=E.view.tC){t={from:E.view.lC,count:E.params.shatts.imagesperpage*(E.view.pC-E.view.lC)};o.push(t)}if(0<o.length)g.getPopupData(E.params.gallId,o,E.params.shatts.imagesperpage,E.params.orderby,E.params.ordering).then(function(e){if(void 0!==e.data.success){var t=e.data.success;if("numbers"==E.params.shatts.pagination)for(var a=0;a<o.length;a++){E.view.pI[o[a].from]=[];for(var i=0;i<o[a].count;i++)void 0!==t[o[a].count*a+i]&&(E.view.pI[o[a].from][i]=t[o[a].count*a+i])}else E.view.pI[0]=E.view.pI[0].concat(t);for(var n=0;n<E.view.pI.length;n++)E.items=E.items.concat(E.view.pI[n])}else f.log("Error , something went wrong.");E.checkForgrsHash()||E.setFW(r)},function(e){f.log(e)});else{f.log("Images already loaded");for(var a=0;a<E.view.pI.length;a++)E.items=E.items.concat(E.view.pI[a]);E.checkForgrsHash()||E.setFW(r)}},E.checkForgrsHash=function(){if(angular.isString(E.view.cImInG)&&-1!=E.view.cImInG.indexOf("hash-")){for(var e=E.view.cImInG.split("hash-")[1],t=!1,a=-1,i=0;i<E.items.length;i++)if(E.items[i].id==e){a=i,t=!0;break}return t?(E.setItem(a,!0),E.setFW(a)):(E.grsCp(),f.log("chkar")),!0}return!1},E.setViewParamsByRes=function(){E.$broadcast("resize::resize")},E.setFW=function(e){E.view.fcw=E.items.length*(E.view.ftw+E.view.ftm+2*(E.view.ftp+E.view.ftbw))+E.view.ftm,E.moveFC("fromImgNav",e)},E.shFilmsVtop=function(){return!("1"!==E.params.shatts.lightboxfilmstrip||!f.config.filmstrip)&&"top"==E.params.theme.filmstripPos},E.shFilmsVbot=function(){return!("1"!==E.params.shatts.lightboxfilmstrip||!f.config.filmstrip)&&"bottom"==E.params.theme.filmstripPos},E.shCbutts=function(){return"1"===E.params.shatts.lightboxcontbutts},E.contButtPos=function(){return E.sisVideo()||E.fisVideo()||E.sisLink()||E.fisLink()?"refactorContent":""},E.grsCheckLNavVis=function(){return 0===E.view.cImInG&&f.settings.hideNavButton?"grsHide":""},E.grsCheckRNavVis=function(){return E.view.cImInG===E.items.length-1&&f.settings.hideNavButton?"grsHide":""},E.shCommCont=function(){return"1"===E.params.shatts.lightboxcomment&&f.config.comments},E.shCommContLoaded=function(){E.options.commContloaded=!0,E.$$phase||E.$apply()},E.shFilmContLoaded=function(){E.options.filmContLoaded=!0,E.$$phase||E.$apply()},E.chSwp=function(){return"1"===E.params.shatts.lightboxswipe?"grsPoin":""},E.fisImage=function(){return"video"!==E.img.type&&"link"!==E.img.type},E.sisImage=function(){return"video"!==E.psImg.type&&"link"!==E.psImg.type},E.fisVideo=function(){return"video"===E.img.type&&"first"===E.view.active},E.sisVideo=function(){return"video"===E.psImg.type&&"second"===E.view.active},E.fisLink=function(){return"link"===E.img.type&&"first"===E.view.active},E.sisLink=function(){return"link"===E.psImg.type&&"second"===E.view.active},E.fImSrc=function(){return E.getLightboxImageSource(E.img,E.view.icw,E.view.ich,"main")},E.sImSrc=function(){return E.getLightboxImageSource(E.psImg,E.view.icw,E.view.ich,"main")},E.setItem=function(e,t){if(E.view.cImInG=e,!angular.isString(E.view.cImInG)||-1==E.view.cImInG.indexOf("hash-")){E.img=void 0===t?E.view.pI[E.view.cP][E.view.cImIn]:E.items[E.view.cImInG],E.view.cImId=E.img.id,E.setLh(E.img.id),E.fillShU(E.img),E.reloadCap();var a=-1!=E.img.type.indexOf(".")?"image":E.img.type;E["setItem_"+a]()}},E.getLightboxImageSource=function(e,t,a,i){if(void 0!==e.embed)return E["getLightboxImageSource_"+e.embed](e,t,a,i)},E.getLightboxImageSource_=function(e,t,a,i){return f.uploaderUrl+e.path+f.getImageVer(t,a,i)+e.name+e.type},E.getLightboxImageSource_wp=function(e,t,a,i){return f.wpUploaderUrl+e.path+e.name+f.getLightboxWPimageSize(e,t,a,i)+e.type},E.getLightboxImageSource_instagram=function(e,t,a,i){return E.getLightboxImageSource_embed(e,t,a,i)},E.getLightboxImageSource_flickr=function(e,t,a,i){return E.getLightboxImageSource_embed(e,t,a,i)},E.getLightboxImageSource_youtube=function(e,t,a,i){return"main"===i?e.path+"&showinfo="+f.settings.showYtTitle:e.thumb_url},E.getLightboxImageSource_vimeo=function(e,t,a,i){return"main"===i?e.path+"?title="+f.settings.showVmTitle:e.thumb_url},E.getLightboxImageSource_embed=function(e,t,a,i){return e["main"!==i?"thumb_url":"path"]},E.setItem_image=function(){var e=new Image,t=E.img,a=E.view;e.src=E.getLightboxImageSource(t,a.icw,a.ich,"main"),e.cImInG=a.cImInG,e.cImId=t.id,e.complete||4===e.readyState?E.setSomeViewParams(e.cImId):(a.loading=!0,e.onload=function(){if(this.cImInG==a.cImInG){var e=this.cImId;E.setSomeViewParams(e)}else f.log("not same for first ---------- ");f.log("first change loading end ---------- "),E.$apply()})},E.setItem_video=function(){E.setSomeViewParams(E.img.id)},E.setItem_link=function(){E.setItem_video()},E.setSomeViewParams=function(e){var t=E.view;t.loading=!1,t.firstIn=!0,t.active="first",t.actImg="first",t.mainAnimationEnd=!1,t.inAnimationEnd=!1,t.outAnimationEnd=!1,t.actImgId=e,E.fillICC(e)},E.setData=function(e,t,a){var i,n={},r=E.items.length,o=E.view.grsCC,s=o.length-1,g=-1<s;if(angular.isString(E.view.cImInG)&&-1!=E.view.cImInG.indexOf("hash-"))f.log("Hash not changed.");else{if("previous"==e?i=g&&!E.view.loading?0<o[s]?o[s]-1:r-1:0<E.view.cImInG?E.view.cImInG-1:r-1:"next"==e?i=g&&!E.view.loading?o[s]<r-1?o[s]+1:0:E.view.cImInG<r-1?E.view.cImInG+1:0:"other"==e?i=void 0!==t?t:0:f.log("Unknown change event"),n.imgData=E.items[i],n.cImInG=i,void 0!==n.imgData)return E.view.mainAnimationEnd||E.view.noEffect?void(i!=E.view.cImInG?E.grsChangeItem(n):f.log("Same index ------ ")):(f.log("Animation in progress ------ "),void(f.settings.collapseNavClicks&&o.length<f.settings.clicksCount?(o.push(n.cImInG),f.log(o)):f.log("Stack is full ------ ")));f.log("Images is not loaded")}},E.grsLeft=function(e){void 0!==e&&e.preventDefault();var t=E.view;t.enAp&&t.setAutoplay&&i.cancel(t.setAutoplay),E.setData("previous")},E.swipeLeft=function(e){"1"==E.params.shatts.lightboxswipe&&E.grsLeft(e)},E.grsRight=function(e){var t=E.view;"boolean"!=typeof e&&t.enAp&&t.setAutoplay&&i.cancel(t.setAutoplay),void 0!==e&&"boolean"!=typeof e&&e.preventDefault(),E.setData("next")},E.swipeRight=function(e){"1"==E.params.shatts.lightboxswipe&&E.grsRight(e)},E.selectImg=function(e,t){var a=E.view;a.enAp&&a.setAutoplay&&i.cancel(a.setAutoplay),E.setData("other",e,t)},E.grsChangeItem=function(e){var t=-1!=e.imgData.type.indexOf(".")?"image":e.imgData.type;E["grsChange_"+t](e)},E.grsChange_image=function(e){var t=e.imgData,a=E.view,i=E.items[a.cImInG].id,n=new Image;if(n.src=E.getLightboxImageSource(t,a.icw,a.ich,"main"),n.img=t,n.cImInG=e.cImInG,n.cImId=t.id,a.cImInG=e.cImInG,a.cImId=t.id,E.grsDoAction(t,i),!n.complete&&4!==n.readyState)return a.grsCC=[],a.loading=!0,void(n.onload=function(){if(this.cImInG==a.cImInG)if(void 0===a.firstIn){f.log("firstIn is set after load---------- "),E.img=E.items[this.cImInG],E.psImg=E.img;var e=this.cImId;E.setSomeViewParams(e)}else{if(a.loading=!1,a.actImgId==this.cImId)return void f.log("same id , so not do effect from loaded");f.log("objImg.loaded ---------- ");E.setSomeViewParamsForChange(this.img)}else f.log("Not same <---------- ");f.log("Change loading end <---------- "),E.$apply()});if(f.log("objImg.complete ---------- "),void 0===a.firstIn)f.log("firstIn is set ---------- "),E.img=E.items[n.cImInG],E.psImg=E.img,E.setSomeViewParams(n.cImId);else{if(a.loading=!1,a.actImgId==a.cImId)return void f.log("same id , so not do effect");E.setSomeViewParamsForChange(t)}},E.setSomeViewParamsForChange=function(e){var t=E.view,a=E.params.shatts.lightboxeffect,i="no"==a?"no":"fade",n="video"!=e.type&&"link"!=e.type&&"video"!=E.img.type&&"link"!=E.img.type&&"video"!=E.psImg.type&&"link"!=E.psImg.type?a:i;f.log("hmikva typ@ -- "+e.type),t.mainAnimationEnd=!1,t.inAnimationEnd=!1,t.outAnimationEnd=!1,E.setEffect(n),E.grsDoEffect(e),E.fillICC(e.id)},E.grsChange_video=function(e){var t=e.imgData,a=E.view,i=E.items[a.cImInG].id;if(a.cImInG=e.cImInG,a.cImId=t.id,E.grsDoAction(t,i),void 0===a.firstIn)f.log("firstIn is set ---------- "),E.img=E.items[a.cImInG],E.psImg=E.img,E.setSomeViewParams(a.cImId);else{if(a.loading=!1,a.actImgId==a.cImId)return void f.log("same id , so not do effect");E.setSomeViewParamsForChange(t)}},E.grsChange_link=function(e){E.grsChange_video(e)},E.grsDoAction=function(e,t){E.moveFC("fromImgNav",E.view.cImInG),E.changeLh(t,e.id),E.fillShU(e)},E.grsDoEffect=function(e){E.view.actImgId=e.id,E[E.view.effect.func](E.view.effect.obj,e)},E.fillShU=function(e){var t,a=E.params.grs;t=""===e.embed?f.uploaderUrl+e.path+"medium/"+e.name+e.type:"wp"===e.embed?f.wpUploaderUrl+e.path+e.name+f.getLightboxWPimageSize(e,1e3,1e3)+e.type:e.thumb_url,E.view.grsFacebook="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(f.shareUrl+"&socialNetwork=facebook&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl())),E.view.grsTwitter="https://twitter.com/intent/tweet?url="+encodeURIComponent(f.shareUrl+"&socialNetwork=twitter&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl()))+"&text="+e.title,E.view.grsPinterest="https://pinterest.com/pin/create/button/?url="+encodeURIComponent(f.shareUrl+"&socialNetwork=pinterest&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl()))+"&media="+encodeURIComponent(t)+"&description="+e.title,E.view.grsTumblr="https://www.tumblr.com/widgets/share/tool?canonicalUrl="+encodeURIComponent(f.shareUrl+"&socialNetwork=tumblr&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl())),E.view.grsLinkedIn="https://www.linkedin.com/shareArticle?url="+encodeURIComponent(f.shareUrl+"&socialNetwork=linkedin&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl())),E.view.grsReddit="https://reddit.com/submit?url="+encodeURIComponent(f.shareUrl+"&socialNetwork=reddit&imageId="+e.id+"&grs="+a+"&curUrl="+encodeURIComponent(n.absUrl()))+"&title="+e.title},E.setLh=function(e){var t=n.path()+"/id/"+e;n.path(t).replace()},E.changeLh=function(e,t){var a=n.path().replace("/id/"+e,"/id/"+t);n.path(a).replace()},E.clearLh=function(){var e=n.path(),t=E.view.cImId,a=e.replace("/id/"+t,"");n.path(a).replace()},E.fillICC=function(e){var t=E.view.cImInG;-1==Object.keys(E.view.comments).indexOf(t.toString())&&(E.view.comments[t]=[],E.view.cloading=!0,g.getImgComm(e,E.params.gallId).then(function(e){E.view.cloading=!1,void 0!==e.data.success&&(E.view.comments[t]=e.data.success)},function(e){f.log(e)}))},E.postIc=function(){var a=void 0!==E.view.grsCommName?E.view.grsCommName:"",e=void 0!==E.view.grsCapCode?E.view.grsCapCode:"",i=void 0!==E.view.grsCommEmail?E.view.grsCommEmail:"",n=void 0!==E.view.grsCommText?E.view.grsCommText:"",r=E.view.cImId,o=E.params.gallId,s=E.view.cImInG;return f.log("gallid"+o),""===a?(E.view.emptyName=!0,void f.log("Name empty")):E.validateEmail(i)?""==n?(E.view.emptyComment=!0,void f.log("Comment empty")):""==e?(E.view.emptyCaptcha=!0,void f.log("Captcha empty")):void(E.view.cloading||(E.view.cloading=!0,g.postIc(a,e,i,n,r,o).then(function(e){if(E.view.cloading=!1,void 0!==e.data.success){var t={id:e.data.success.insert_id,imgId:r,name:a,galId:o,email:i,comment:n,createDate:e.data.success.createDate};E.view.comments[s].push(t),E.view.grsCapCode="",E.view.grsCommText="",E.reloadCap(),E.view.emptyName=!1,E.view.emptyComment=!1,E.view.emptyCaptcha=!1,E.view.invalidMail=!1}else{if(void 0!==e.data.error)return E.reloadCap(),E.view.grsCapCode="",E.view.emptyCaptcha=!1,void(E.view.emptyCaptcha=!0);f.log("Eror code : "+e.data.error)}},function(e){f.log(e)}))):(E.view.invalidMail=!0,void f.log("Email validation"))},E.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},E.getFilmImageSrc=function(e){var t=E.items[e],a=E.params.theme;return E.getLightboxImageSource(t,parseInt(a.filmThumbWidth),parseInt(a.filmstripSize),"thumbnail")},E.reloadCap=function(){E.view.cloading||(E.view.cloading=!0,g.reloadCap().then(function(e){E.view.cloading=!1,void 0!==e.data.success&&(E.view.captcha=e.data.success)},function(e){f.log(e)}))},E.moveFC=function(e,t){var a,i,n,r,o=E.view.flp,s=E.items.length,g=!1,h=E.view.fcw,l=E.view.icw,p=E.view.ftw+E.view.ftm+2*(E.view.ftp+E.view.ftbw),m=f.settings.fmImMoveCount,c=Math.floor(Math.floor(l/p)/2),d=c<m?0===c?1:c:m;if("left"===e){if(h<=l+-1*o)return;a=u(o-(h-(l+-1*o))%p,!1)}else if("right"===e){if(0===o)return;a=u(o+-1*o%p,!0)}else"fromImgNav"===e&&(r=(s-t-1)*p,i=h-(l+-1*o),o<=(n=t*p*-1)||-1*n- -1*o<p?a=u(n,!0):r<=i||r-i<p?a=u(-1*(a=h-r-l),!1):g=!0);function u(e,t){var a=t?-1*parseInt(e/p):parseInt((h-(l+-1*e))/p);if(0<a){var i=a<d?a:d;t?e+=i*p:e-=i*p}return e}g||(E.view.flp=a,E.$$phase||E.$apply())},E.hideNav=function(){return E.view.icw+-1*E.view.flp>=E.view.fcw},E.grsSInf=function(e){E.view.shInf=!E.view.shInf},E.grsGetInfT=function(){return"first"==E.view.active?E.img.title:E.psImg.title},E.grsGetInfD=function(){return"first"==E.view.active?E.img.description:E.psImg.description},E.grsEnAp=function(){E.view.enAp=!E.view.enAp,E.view.enAp?E.doAutoPlay():E.view.setAutoplay&&i.cancel(E.view.setAutoplay)},E.grsPopupEnAp=function(){return E.view.enAp?"fa-"+E.params.theme.pause:"fa-"+E.params.theme.play},E.doAutoPlay=function(){var e=E.view;e.setAutoplay&&i.cancel(e.setAutoplay),e.setAutoplay=i(function(e){E.grsRight(!0)},e.apInt)},E.grsSFM=function(e){var t=document.getElementById("grsPopup");E.view.isFS?(document.webkitFullscreenEnabled?(document.webkitExitFullscreen(),E.view.isFS=!1):document.mozFullScreenEnabled?(document.mozCancelFullScreen(),E.view.isFS=!1):document.msFullscreenEnabled?(document.msExitFullscreen(),E.view.isFS=!1):document.fullscreenEnabled&&document.exitFullscreen&&(document.exitFullscreen(),E.view.isFS=!1),E.view.isFS||(E.view.isFSSmart=!1),E.$broadcast("resize::resize")):(document.fullscreenEnabled&&document.requestFullscreen?(t.requestFullscreen(),E.view.isFS=!0):document.webkitFullscreenEnabled?(t.webkitRequestFullscreen(),E.view.isFS=!0):document.mozFullScreenEnabled?(t.mozRequestFullScreen(),E.view.isFS=!0):document.msFullscreenEnabled&&(t.msRequestFullscreen(),E.view.isFS=!0),E.view.isFS&&i(function(){E.view.isFSSmart=!0},300),E.resizePc(screen.width,screen.height))},E.grsPopupOFCl=function(){return E.view.isFS?"fa-"+E.params.theme.min:"fa-"+E.params.theme.max},E.$on("resize::resize",function(){var e=h.innerWidth,t=h.innerHeight,a=E.params.shatts,i=e<700||t<500,n="1"==a.lightboxfullw,r=n||i?e:a.lightboxwidth,o=n||i?t:a.lightboxheight;if(!E.view.isFS){var s=e<parseInt(r)?Math.floor(e):parseInt(r),g=parseInt(o);t<(g=e<parseInt(r)?Math.floor(g*s/parseInt(r)):g)&&(g=Math.floor(t),s=Math.floor(g*parseInt(r)/parseInt(o))),E.resizePc(s,g)}}),E.resizeToWin=function(e){E.params.shatts.lightboxfullw=e?"1":"0",E.$broadcast("resize::resize")},E.resizePc=function(e,t){if(!E.view.mainAnimationEnd&&!E.view.noEffect)return f.log("Animation in progress, trying to resize containner"),E.view.cachResActW=e,void(E.view.cachResActH=t);var a=h.innerWidth,i=h.innerHeight;if(E.view.mcw=e,E.view.mch=t,E.view.isOCC?(E.view.ccw=Math.floor(40*E.view.mcw/100),E.view.icw=E.view.mcw-E.view.ccw,E.view.ccr=0):(E.view.ccw=Math.floor(40*E.view.mcw/100),E.view.ccr=-E.view.ccw,E.view.icw=E.view.mcw),a<400||i<200){var n=f.getWidthHeightForFmResize(50,parseInt(E.params.theme.filmThumbWidth),parseInt(E.params.theme.filmstripSize));E.view.fs=n.height,E.view.ftw=n.width,E.view.ftm=parseInt(parseInt(E.params.theme.filmThumbMargin)/4),E.view.fmTop=parseInt(parseInt(E.params.theme.filmstripMarginTop)/4),E.view.fmBottom=parseInt(parseInt(E.params.theme.filmstripMarginBottom)/4),E.view.ftp=0,E.view.ftbw=0}else if(a<700||i<500){n=f.getWidthHeightForFmResize(80,parseInt(E.params.theme.filmThumbWidth),parseInt(E.params.theme.filmstripSize));E.view.fs=n.height,E.view.ftw=n.width,E.view.ftm=parseInt(parseInt(E.params.theme.filmThumbMargin)/2),E.view.fmTop=parseInt(parseInt(E.params.theme.filmstripMarginTop)/2),E.view.fmBottom=parseInt(parseInt(E.params.theme.filmstripMarginBottom)/2),E.view.ftp=0,E.view.ftbw=0}else E.view.fs=parseInt(E.params.theme.filmstripSize),E.view.ftw=parseInt(E.params.theme.filmThumbWidth),E.view.ftm=parseInt(E.params.theme.filmThumbMargin),E.view.fmTop=parseInt(E.params.theme.filmstripMarginTop),E.view.fmBottom=parseInt(E.params.theme.filmstripMarginBottom),E.view.ftp=parseInt(E.params.theme.filmThumbPadding),E.view.ftbw="none"!=E.params.theme.filmThumbBorderStyle?parseInt(E.params.theme.filmThumbBorderWidth):0;E.view.flp=0,E.view.fch=E.view.fs+E.view.fmTop+E.view.fmBottom+2*(E.view.ftp+E.view.ftbw),E.view.ich="1"==E.params.shatts.lightboxfilmstrip?E.view.mch-E.view.fch:E.view.mch,E.view.cbcP="bottom"==E.params.theme.filmstripPos?"top":"bottom",!E.view.contButtOp&&jQuery(".grsPopupB").outerHeight()&&(jQuery(".grsPopupBc").css(E.view.cbcP,-jQuery(".grsPopupB").outerHeight()),f.log(E.view.cbcP+" #$ "+-jQuery(".grsPopupB").outerHeight())),0<E.items.length&&E.setFW(E.view.cImInG),0<E.view.grsCC.length&&E.selectImg(E.view.grsCC.shift(),!0),E.$$phase||E.$apply()},E.clBposRes=function(){var e="";if(h.innerWidth===E.view.mcw){var t=E.params.shatts,a=E.params.theme,i=E.view.isOCC;e="1"===t.lightboxfilmstrip&&-1!==a.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithFilm":"1"===t.lightboxcontbutts&&-1===a.filmstripPos.indexOf("top")?"grsPopupCoCClosResWithContButts":"grsPopupCoCClosRes",e=i?"comm":e}return e},E.grsOCC=function(e){var t=E.view;if(!t.isOCC){if(!t.mainAnimationEnd&&!t.noEffect)return f.log("Animation in progress, trying to open comments"),void(t.cachCmmAct=E.grsOCC);var a=t.mcw-t.ccw,i=""==t.active?"first":t.active,n=document.querySelector("."+i+" .forEffect"),r=document.querySelector(".grsPopupImC"),o=document.querySelector(".grsPopupCoC"),s=!!n&&n.querySelector("img");jQuery(r).animate({width:a},{duration:500,queue:!1,complete:function(){t.icw=a,t.isOCC=!0,0<E.items.length&&E.moveFC("fromImgNav",t.cImInG),E.$$phase||E.$apply()}}),jQuery(o).animate({right:0},{duration:500,queue:!1,complete:function(){E.$$phase||(t.ccr=0)}}),s&&(jQuery(n).animate({maxWidth:a},{duration:500,queue:!1,complete:function(){}}),jQuery(s).animate({maxWidth:a},{duration:500,queue:!1,complete:function(){0<t.grsCC.length&&E.selectImg(t.grsCC.shift(),!0)}}))}},E.grsCCC=function(e){var t=E.view,a=""==t.active?"first":t.active,i=document.querySelector("."+a+" .forEffect"),n=document.querySelector(".grsPopupImC"),r=document.querySelector(".grsPopupCoC"),o=!!i&&i.querySelector("img");if(!t.mainAnimationEnd&&!t.noEffect)return f.log("Animation in progress, trying to closw comments"),void(t.cachCmmAct=E.grsCCC);jQuery(n).animate({width:t.mcw},{duration:500,queue:!1,complete:function(){t.icw=t.mcw,t.isOCC=!1,E.$$phase||E.$apply()}}),jQuery(r).animate({right:-t.ccw},{duration:500,queue:!1,complete:function(){E.$$phase||(t.ccr=-t.ccw,0<E.items.length&&(t.flp=0,E.setFW(t.cImInG)))}}),o&&(jQuery(o).animate({maxWidth:t.mcw},{duration:500,queue:!1,complete:function(){0<t.grsCC.length&&E.selectImg(t.grsCC.shift(),!0)}}),jQuery(i).animate({maxWidth:t.mcw},{duration:500,queue:!1,complete:function(){}}))},E.grsCpFrSide=function(e){f.settings.closeLbOnSide&&E.grsCp()},E.grsCp=function(e){void 0!==e&&e.preventDefault(),document.webkitFullscreenEnabled&&document.webkitExitFullscreen?(document.webkitExitFullscreen(),E.view.isFS=!1):document.mozFullScreenEnabled&&document.mozCancelFullScreen?(document.mozCancelFullScreen(),E.view.isFS=!1):document.msFullscreenEnabled&&document.msExitFullscreen?(document.msExitFullscreen(),E.view.isFS=!1):document.fullscreenEnabled&&document.exitFullscreen&&(document.exitFullscreen(),E.view.isFS=!1),jQuery("html, body").removeClass("grsPopupParents");var t={show:!1,grs:0,gallId:0,shatts:{},theme:{},pI:[],items:[],cP:0,pC:0,tC:0,lC:0,index:0};E.clearLh(),f.setPopObj(t)},E.setEffect=function(e){if("random"!=e){for(var t in E.grsEffects)for(var a in E.grsEffects[t].effects)if(a==e){E.view.effect.obj=E.grsEffects[t].effects[a],E.view.effect.name=a,E.view.effect.func=E.grsEffects[t].doEffect,E.view.effect.type=t;break}}else E.setRandomEffect()},E.setRandomEffect=function(){var e=0,t=E.getRandomNum(0,Object.keys(E.grsEffects).length-1);for(var a in E.grsEffects){if(e==t){var i=0,n=E.getRandomNum(0,Object.keys(E.grsEffects[a].effects).length);for(var r in E.grsEffects[a].effects){if(i==n){E.view.effect.obj=E.grsEffects[a].effects[r],E.view.effect.name=r,E.view.effect.func=E.grsEffects[a].doEffect,E.view.effect.type=a;break}i++}}e++}},E.getRandomNum=function(e,t){return Math.floor(Math.random()*t)+e},E.grsNoEffect=function(e,t){"first"==E.view.active?(E.psImg=t,E.view.actImg="second",E.view.active="second"):"second"==E.view.active&&(E.img=t,E.view.actImg="first",E.view.active="first"),E.view.enAp&&E.doAutoPlay(),E.$$phase||E.$apply()},E.grsNoCuting=function(e,t){"first"===E.view.active?(E.view.active="second",E.psImg=t):"second"===E.view.active&&(E.view.active="first",E.img=t),E.$$phase||E.$apply()},E.grsXcutting=function(e,t){var a,i,n,r,o,s=E.view;"first"===s.active?(a=E.img,n=E.getLightboxImageSource(a,s.icw,s.ich,"main"),r="first",o="second",E.psImg=t,s.active="second",s.actImg="second"):(i=E.psImg,n=E.getLightboxImageSource(i,s.icw,s.ich,"main"),r="second",o="first",E.img=t,s.active="first",s.actImg="first");var g=document.querySelector("div."+r),h=document.querySelector("div."+o),l=g.querySelector("img");h.querySelector("img");E.$$phase||E.$apply();var p=g.childNodes[2].childNodes[1],m=p.childNodes[2],c=h.childNodes[2].childNodes[1],d=c.childNodes[2],u=l.getBoundingClientRect(),f=u.width,v=u.height,w=Math.floor(f/11);m&&p.removeChild(m),d&&c.removeChild(d);var I=document.createElement("div");I.style.width=12*w+"px",I.style.height=v+"px",I.style.position="absolute",I.style.top="0px",I.style.left="0px",I.style.textAlign="left",I.setAttribute("class","forlyalya");for(var b=E.effectsTiming.msForEffHor,C=0;C<12;C++){var y=C*w*-1,x=50*C,P=1500;11===C&&(x=50*(C-1)),"Safari"===E.browser.name&&(x=0,P=b[C]);var S=document.createElement("div");S.setAttribute("style","width:"+w+"px;height:"+v+"px;position:absolute;left:"+C*w+"px;top:0px;padding:0px;"+e.transformStyle+'margin:0px;background:url("'+n+'") no-repeat '+y+"px 0px;background-size:"+f+"px "+v+"px;-webkit-animation:"+e.name+" "+P+"ms ease-in-out "+x+"ms 1 normal both;-moz-animation:"+e.name+" "+P+"ms ease-in-out "+x+"ms 1 normal both;-ms-animation:"+e.name+" "+P+"ms ease-in-out "+x+"ms 1 normal both;-o-animation:"+e.name+" "+P+"ms ease-in-out "+x+"ms 1 normal both;animation:"+e.name+" "+P+"ms ease-in-out "+x+"ms 1 normal both;"),S.setAttribute("class","grsXorYCutMiniTransElem_"+C),I.appendChild(S)}p.appendChild(I)},E.grsYcutting=function(e,t){if("first"==E.view.active){var a=E.img,i=E.getLightboxImageSource(a,E.view.icw,E.view.ich,"main"),n="first",r="second";E.psImg=t,E.view.active="second",E.view.actImg="second"}else{var o=E.psImg;i=E.getLightboxImageSource(o,E.view.icw,E.view.ich,"main"),n="second",r="first";E.img=t,E.view.active="first",E.view.actImg="first"}var s=document.querySelector("div."+n),g=document.querySelector("div."+r),h=s.querySelector("img");g.querySelector("img");E.$$phase||E.$apply();var l=s.childNodes[2].childNodes[1],p=l.childNodes[2],m=g.childNodes[2].childNodes[1],c=m.childNodes[2],d=h.getBoundingClientRect(),u=d.width,f=d.height,v=Math.floor(f/11);p&&l.removeChild(p),c&&m.removeChild(c);var w=document.createElement("div");w.style.width=u+"px",w.style.height=12*v+"px",w.style.position="absolute",w.style.top="0px",w.style.left="0px",w.style.textAlign="left",w.setAttribute("class","forlyalya");for(var I=E.effectsTiming.msForEffHor,b=0;b<12;b++){var C=b*v*-1,y=50*b,x=1500;11==b&&(y=50*(b-1)),"Safari"==E.browser.name&&(y=0,x=I[b]);var P=document.createElement("div");P.setAttribute("style","width:"+u+"px;height:"+v+"px;position:absolute;left:0px;top:"+b*v+"px;"+e.transformStyle+'background:url("'+i+'") no-repeat 0px '+C+"px;background-size:"+u+"px "+f+"px;-webkit-animation:"+e.name+" "+x+"ms ease-in "+y+"ms 1 normal both;-moz-animation:"+e.name+" "+x+"ms ease-in "+y+"ms 1 normal both;-ms-animation:"+e.name+" "+x+"ms ease-in "+y+"ms 1 normal both;-o-animation:"+e.name+" "+x+"ms ease-in "+y+"ms 1 normal both;animation:"+e.name+" "+x+"ms ease-in "+y+'ms 1 normal both;" '),P.setAttribute("class","grsXorYCutMiniTransElem_"+b),w.appendChild(P)}l.appendChild(w)},E.grsXYcutting=function(e,t){if("first"==E.view.active){var a=E.img,i=E.getLightboxImageSource(a,E.view.icw,E.view.ich,"main"),n="first",r="second";E.psImg=t,E.view.active="second",E.view.actImg="second"}else{var o=E.psImg;i=E.getLightboxImageSource(o,E.view.icw,E.view.ich,"main"),n="second",r="first";E.img=t,E.view.active="first",E.view.actImg="first"}var s=document.querySelector("div."+n),g=document.querySelector("div."+r),h=s.querySelector("img");g.querySelector("img");E.$$phase||E.$apply();var l=s.childNodes[2].childNodes[1],p=l.childNodes[2],m=g.childNodes[2].childNodes[1],c=m.childNodes[2],d=h.getBoundingClientRect(),u=d.width,f=d.height,v=Math.floor(u/5),w=Math.floor(f/5),I=document.createElement("div");I.style.width=6*v+"px",I.style.height=6*w+"px",I.style.position="absolute",I.style.top="0px",I.style.left="0px",I.style.textAlign="left",I.setAttribute("class","forlyalya"),p&&l.removeChild(p),c&&m.removeChild(c);for(var b=0,C=0,y=E.effectsTiming.msForEff,x=0;x<6;x++){C="fun"==e.type?70*x+50*x:0;for(var P=0;P<6;P++){var S=x*w*-1,k=P*v*-1,A=1e3;C="fun"==e.type?C+70:30*b,"Safari"==E.browser.name&&(C=0,A=y[b]);var T=document.createElement("div");T.setAttribute("style","width:"+v+"px;height:"+w+"px;float:left;"+e.transformStyle+'background:url("'+i+'") no-repeat '+k+"px "+S+"px;background-size:"+u+"px "+f+"px;-webkit-animation:"+e.name+" "+A+"ms ease-in-out "+C+"ms 1 normal both;-moz-animation:"+e.name+" "+A+"ms ease-in-out "+C+"ms 1 normal both;-ms-animation:"+e.name+" "+A+"ms ease-in-out "+C+"ms 1 normal both;-o-animation:"+e.name+" "+A+"ms ease-in-out "+C+"ms 1 normal both;animation:"+e.name+" "+A+"ms ease-in-out "+C+'ms 1 normal both;" '),T.setAttribute("class","grsXYCutMiniTransElem_"+b),I.appendChild(T),b++}}l.appendChild(I)},E.grsXYcuttingIn=function(e,t){if("first"==E.view.active){var a="first",i="second";E.psImg=t,E.view.active="second"}else{a="second",i="first";E.img=t,E.view.active="first"}var n=document.querySelector("div."+a),r=document.querySelector("div."+i),o=(n.querySelector("img"),r.querySelector("img")),s=E.getLightboxImageSource(t,E.view.icw,E.view.ich,"main");o.setAttribute("src",s),E.$$phase||E.$apply(),E.view.actImg="second"==E.view.active?"first":"second";var g=n.childNodes[2].childNodes[1],h=g.childNodes[2],l=r.childNodes[2].childNodes[1],p=l.childNodes[2],m=o.clientWidth,c=o.clientHeight;h&&g.removeChild(h),p&&l.removeChild(p);var d=Math.floor(m/5),u=Math.floor(c/5),f=document.createElement("div");f.style.width=6*d+"px",f.style.height=6*u+"px",f.style.position="absolute",f.style.top="0px",f.style.left="0px",f.style.textAlign="left",f.setAttribute("class","forlyalya");for(var v=0,w=0,I=E.effectsTiming.msForEff,b=0;b<6;b++){w="fun"==e.type?50*b+50*b:0;for(var C=0;C<6;C++){var y=b*u*-1,x=C*d*-1,P=1200;w="fun"==e.type?w+50:30*v,"Safari"==E.browser.name&&(w=0,P=I[v]);var S=document.createElement("div");S.setAttribute("style","width:"+d+"px;height:"+u+"px;float:left;"+e.transformStyle+'background:url("'+s+'") no-repeat '+x+"px "+y+"px;background-size:"+m+"px "+c+"px;-webkit-animation:"+e.name+" "+P+"ms ease-in-out "+w+"ms 1 normal both;-moz-animation:"+e.name+" "+P+"ms ease-in-out "+w+"ms 1 normal both;-ms-animation:"+e.name+" "+P+"ms ease-in-out "+w+"ms 1 normal both;-o-animation:"+e.name+" "+P+"ms ease-in-out "+w+"ms 1 normal both;animation:"+e.name+" "+P+"ms ease-in-out "+w+'ms 1 normal both;" '),S.setAttribute("class","grsXYInCutMiniTransElem_"+v),f.appendChild(S),v++}}l.appendChild(f)},E.classFfI=function(){return"noCutting"!=E.view.effect.type?"first"==E.view.actImg?"opset":"opzero":void 0===E.view.firstIn?"opzero":"opset"},E.classFsI=function(){return"noCutting"!=E.view.effect.type?"second"==E.view.actImg?"opset":"opzero":void 0===E.view.firstIn?"opzero":E.view.firstIn?"opzero":"opset"},E.classFfD=function(){return E[E.view.effect.type+"_fD"]()},E.classFsD=function(){return E[E.view.effect.type+"_sD"]()},E.noEffect_fD=function(){return"first"===E.view.active?"active":"pasive"},E.noEffect_sD=function(){return"second"===E.view.active?"active":"pasive"},E.noCutting_fD=function(){return"first"===E.view.active?E.view.effect.obj.in+" active":"second"===E.view.active?E.view.effect.obj.out+" pasive":void 0},E.noCutting_sD=function(){return"second"===E.view.active?E.view.effect.obj.in+" active":"first"===E.view.active?E.view.effect.obj.out+" pasive":void 0},E.cuttingX_fD=function(){return(E.view.firstIn?"grsFrInEff ":"")+("first"==E.view.active?E.view.effect.obj.activeC+" active":"")},E.cuttingX_sD=function(){return"second"==E.view.active?E.view.effect.obj.activeC+" active":""},E.cuttingY_fD=function(){return(E.view.firstIn?"grsFrInEff ":"")+("first"==E.view.active?E.view.effect.obj.activeC+" active":"")},E.cuttingY_sD=function(){return"second"==E.view.active?E.view.effect.obj.activeC+" active":""},E.cuttingXY_fD=function(){return(E.view.firstIn?"grsFrInEff ":"")+("first"==E.view.active?E.view.effect.obj.activeC+" active":"")},E.cuttingXY_sD=function(){return"second"==E.view.active?E.view.effect.obj.activeC+" active":""},E.cuttingXYIn_fD=function(){return(E.view.firstIn?"grsFrInEff ":"")+("first"==E.view.active?"grsFadeIn grsAnDur active":E.view.effect.obj.pasiveC)},E.cuttingXYIn_sD=function(){return"second"==E.view.active?"grsFadeIn grsAnDur active":E.view.effect.obj.pasiveC},E.PrefixedEvent=function(a){for(var e=E.browser.pfx,t=0;t<e.length;t++)e[t]||(a=a.toLowerCase()),document.querySelector("body").addEventListener(e[t]+a,function(e){if("animationend"==a){if(-1!=e.target.getAttribute("class").indexOf("grsFrInEff"))return f.log('end of first "in" grsFrInEff'),E.view.mainAnimationEnd=!0,E.view.firstIn=!1,void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,void delete E.view.cachResActH):void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),void delete E.view.cachCmmAct):(0<E.view.grsCC.length?E.selectImg(E.view.grsCC.shift(),!0):(E.view.enAp&&E.doAutoPlay(),f.log('end of first "in" !scope.$$phase --- '+!E.$$phase)),void E.$apply());if(-1!=e.target.getAttribute("class").indexOf("inAnimationEnd")){if(f.log("inAnimationEnd anim ------------------- "),E.view.inAnimationEnd=!0,f.log("scope.view.inAnimationEnd --- "+E.view.inAnimationEnd),f.log("scope.view.outAnimationEnd --- "+E.view.outAnimationEnd),!E.view.outAnimationEnd)return;return E.view.firstIn=!1,E.view.mainAnimationEnd=!0,void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,void delete E.view.cachResActH):void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),void delete E.view.cachCmmAct):(0<E.view.grsCC.length?(f.log("scope.view.grsCC.shift in ------------- "),f.log(E.view.grsCC),E.selectImg(E.view.grsCC.shift(),!0)):E.view.enAp&&E.doAutoPlay(),void E.$apply())}if(-1!=e.target.getAttribute("class").indexOf("outAnimationEnd")){if(f.log("outAnimationEnd anim ------------- "),E.view.outAnimationEnd=!0,f.log("scope.view.outAnimationEnd --- "+E.view.outAnimationEnd),f.log("scope.view.inAnimationEnd --- "+E.view.inAnimationEnd),!E.view.inAnimationEnd)return;return E.view.firstIn=!1,E.view.mainAnimationEnd=!0,void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,void delete E.view.cachResActH):void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),void delete E.view.cachCmmAct):(0<E.view.grsCC.length&&(f.log("scope.view.grsCC.shift ------------- "),f.log(E.view.grsCC),E.selectImg(E.view.grsCC.shift(),!0)),E.view.enAp&&E.doAutoPlay(),void E.$apply())}if(-1!=e.target.getAttribute("class").indexOf("grsXorYCutMiniTransElem_11"))return E.view.mainAnimationEnd=!0,void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,void delete E.view.cachResActH):void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),void delete E.view.cachCmmAct):(0<E.view.grsCC.length?E.selectImg(E.view.grsCC.shift(),!0):(E.view.enAp&&E.doAutoPlay(),f.log("grsXorYCutMiniTransElem_11 end ---------- "),f.log(E.view.grsCC)),void E.$apply());if(-1!=e.target.getAttribute("class").indexOf("grsXYCutMiniTransElem_35"))return E.view.mainAnimationEnd=!0,void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,void delete E.view.cachResActH):void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),void delete E.view.cachCmmAct):(0<E.view.grsCC.length?E.selectImg(E.view.grsCC.shift(),!0):(E.view.enAp&&E.doAutoPlay(),f.log("grsXYCutMiniTransElem_35 end ---------- "),f.log(E.view.grsCC)),void E.$apply());if(-1!=e.target.getAttribute("class").indexOf("grsXYInCutMiniTransElem_35")){E.view.actImg="second"==E.view.actImg?"first":"second",E.view.mainAnimationEnd=!0;var t=document.querySelector("div."+E.view.active).childNodes[2].childNodes[1];return forlyalya=t.childNodes[2],forlyalya&&t.removeChild(forlyalya),void 0!==E.view.cachResActW?(E.resizePc(E.view.cachResActW,E.view.cachResActH),delete E.view.cachResActW,delete E.view.cachResActH,void E.$apply()):(void 0!==E.view.cachCmmAct?(E.view.cachCmmAct(),delete E.view.cachCmmAct):0<E.view.grsCC.length?E.selectImg(E.view.grsCC.shift(),!0):E.view.enAp&&E.doAutoPlay(),void E.$apply())}}},!1)},E.keyBoardEvents=function(){document.addEventListener("keydown",function(e){if(E.options.show){var t=e.key;if("Control"!==t)if(e.ctrlKey);else{switch(t){case"ArrowRight":case"Right":E.grsRight();break;case"ArrowLeft":case"Left":E.grsLeft();break;case"Escape":case"Esc":E.grsCp();break;case" ":case"Spacebar":break;default:return}E.$$phase||E.$apply()}}},!1)},E.fullscreenChange=function(){document.addEventListener("webkitfullscreenchange",function(e){E.view.isFSSmart&&E.grsSFM()}),document.addEventListener("mozfullscreenchange",function(e){E.view.isFSSmart&&E.grsSFM()}),document.addEventListener("fullscreenchange",function(e){E.view.isFSSmart&&E.grsSFM()}),document.addEventListener("MSFullscreenChange",function(e){E.view.isFSSmart&&E.grsSFM()})},E.PrefixedEvent("AnimationEnd"),E.keyBoardEvents(),E.fullscreenChange(),E.getTrans=f.getTrans}}}]),grsApp.directive("grsMosaic",["$filter","GrsFactory","GrsService","$window","$location",function(e,i,n,r,t){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:n.getViewsTemplateUrl("grsMosaic"),link:function(o,a,e){o.sortingOrder="id",o.reverse=!0,o.message={type:"success",show:!1,text:""},o.params.contHeight=50,o.params.contHeightFirstBinding=!1,o.params.loadedCount=0,o.params.prevContWidth=!1,o.params.prevLoadedCount=0,o.params.prevCP=!1,o.pageination={pN:0,forGallery:!0,grs:o.params.grs,items:o.params.data.images,navView:o.params.shatts.pagination,gallery:o.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(o.params.shatts.imagesperpage),orderBy:o.params.shatts.orderby,ordering:o.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){o.MosaicPositioning()},message:function(e,t,a){o.message.show=e,o.message.text=t,o.message.type=void 0!==a?a:"success"},checkScrolling:function(){return n.log("ekanq mas scrolling"),o.checkScrolling()}},o.clickAction=function(e,t){void 0!==t&&t.preventDefault(),o["clickAction"+o.params.shatts.clickaction](e)},o.clickActiondoNothing=function(){},o.clickActionopenLightbox=function(e){var t=o.params,a=o.pageination;o.setLh(),n.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},o.clickActionopenLink=function(e){n.link(o.pageination.pagedItems[o.pageination.currentPage][e],o.params.shatts.openlinktarget)},o.$on("resize::resize",function(){o.pageination.gallExists&&(o.pageination.positioning(),o.$$phase||o.$apply())}),o.$on("scroll::scroll",function(){if("scrolling"===o.pageination.navView&&!o.pageination.loading){var e=jQuery("#grsGal"+o.params.grs),t=e.offset().top+e.innerHeight(),a=r.innerHeight;a/10<r.pageYOffset+a-t?(o.pageination.scrolling=!0,n.log("thumb mek 10ic ancanq")):o.pageination.scrolling=!1,o.$$phase||o.$apply()}}),o.checkScrolling=function(){if("scrolling"===o.pageination.navView){var e=jQuery("html").innerHeight();if(n.log("jjj "+(r.pageYOffset+r.innerHeight)),n.log("vvv "+e),n.log("grsGallHeight "+a.find(".grsImsCont").innerHeight()),r.innerHeight>=e||r.pageYOffset+r.innerHeight>e){n.log("activate scrolling"),n.log("new val for right fireing watcher");var t=o.pageination.scrolling?o.pageination.scrolling:2;return n.log("gaga"+t),t*t}return!1}},o.$watch(function(){if("scrolling"==o.pageination.navView){if(o.pageination.loading)return n.log("Height watcher loading is true"),void n.log("Height watcher loading params height "+o.params.contHeight);var e=a.find(".grsImsCont").innerHeight();0!=e?Math.round(o.params.contHeight)!=Math.round(e)?n.log("live height not set or same live height"):o.params.loadedCount!=o.pageination.loadedCount?(o.params.loadedCount=o.pageination.loadedCount,o.pageination.scrolling=o.checkScrolling()):n.log("loaded - "+o.pageination.loadedCount):n.log("Height watcher , gallCont@ der live height chuni")}}),o.imgLoaded=function(e,t){o.pageination.pagedItems[o.pageination.currentPage][e].show=!0},o.setLh=function(){t.path("/grs/"+o.params.grs).replace()},o.params.getDataById=function(e,t,a){var i={},n=0;itemsCount=o.pageination.items.length;for(var r=0;r<itemsCount;r++)if(o.pageination.items[r].id==e){n=r;break}return i.imgData=o.pageination.items[n],i.curentImgIndex=n,i},o.MosaicPositioning=function(){i["Mosaic"+n.toUpperCaseFl(o.params.shatts.type)+"Positioning"](o.params,o.pageination,"")},o.getImageSrc=function(e){var t=o.pageination.pagedItems[o.pageination.currentPage][e];return n.getImageSource(t,"mosaic")},o.grsShTC=function(){return n.grsShTC(o.params.shatts.title,o.params.data.theme.mosaic.mosaicTEffect)},o.shVIc=function(e){return n.shVIc(o.pageination.pagedItems[o.pageination.currentPage][e])},o.grsOnhv=function(){return n.grsOnhv(o.params.shatts.title)?"grsTOnhover":""},o.grsShMC=function(){return n.grsShMC(o.params.shatts.title,o.params.data.theme.mosaic.mosaicTEffect)},o.CheckGrsHash=function(){var e=r.location.hash,t=o.params.grs,a=!1;if(-1!==e.indexOf("grs")){var i=e.split("/");if(i[2]==t&&3<i.length){imageId=i.pop();for(var n=0;n<o.pageination.pagedItems[0].length;n++)if(o.pageination.pagedItems[0][n].id==imageId){a=!0;break}a?o.clickAction(n):o.clickAction("hash-"+imageId)}}},o.$watch(function(){return n.settingsReady},function(e,t){e&&i.getGalleryData(0,o.pageination.itemsPerPage,o.params.shatts.id,1,o.params.shatts.orderby,o.params.shatts.ordering,o.params.shatts.theme,o.params.shatts.view).then(function(e){o.pageination.gallExists=e.data.gallExists,o.pageination.loading=!1,o.params.data.theme.mosaic=JSON.parse(e.data.theme.mosaic),o.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),o.pageination.pagedItems[0]=e.data.images,o.pageination.totalcount=e.data.count,o.pageination.pagesCount=Math.ceil(o.pageination.totalcount/o.pageination.itemsPerPage),o.pageination.loadedCount=0<o.pageination.pagesCount?1:0,o.pageination.gallExists&&(o.pageination.positioning(),o.CheckGrsHash())},function(e){n.log(e)})},!0)}}}]),grsApp.directive("grsMasonry",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,i,o,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:i.getViewsTemplateUrl("grsMasonry"),link:function(r,t,e){r.sortingOrder="id",r.reverse=!0,r.message={type:"success",show:!1,text:""},r.params.contHeight=50,r.params.contHeightFirstBinding=!1,r.params.loadedCount=0,r.pageination={pN:0,forGallery:!0,grs:r.params.grs,items:r.params.data.images,navView:r.params.shatts.pagination,gallery:r.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,view:r.params.shatts.pagination,itemsPerPage:parseInt(r.params.shatts.imagesperpage),orderBy:r.params.shatts.orderby,ordering:r.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){r.MasonryPositioning()},message:function(e,t,a){r.message.show=e,r.message.text=t,r.message.type=void 0!==a?a:"success"},checkScrolling:function(){return i.log("ekanq mas scrolling"),r.checkScrolling()}},r.clickAction=function(e,t){void 0!==t&&t.preventDefault(),r["clickAction"+r.params.shatts.clickaction](e)},r.clickActiondoNothing=function(){},r.clickActionopenLightbox=function(e){var t=r.params,a=r.pageination;r.setLh(),i.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},r.clickActionopenLink=function(e){i.link(r.pageination.pagedItems[r.pageination.currentPage][e],r.params.shatts.openlinktarget)},r.$on("resize::resize",function(){r.pageination.gallExists&&(r.pageination.positioning(),r.$$phase||r.$apply())}),r.$on("scroll::scroll",function(){if("scrolling"==r.pageination.navView&&!r.pageination.loading){var e=jQuery("#grsGal"+r.params.grs).offset().top+jQuery("#grsGal"+r.params.grs).innerHeight(),t=o.innerHeight,a=o.pageYOffset+t;r.pageination.scrolling=t/10<a-e,r.$$phase||r.$apply()}}),r.checkScrolling=function(){if("scrolling"==r.pageination.navView){var e=jQuery("html").innerHeight();if(o.innerHeight>=e||o.pageYOffset+o.innerHeight>e){var t=r.pageination.scrolling?r.pageination.scrolling:2;return t*t}return!1}},r.$watch(function(){if("scrolling"==r.pageination.navView&&!r.pageination.loading){var e=t.find(".grsImsCont").innerHeight();0!=e&&(Math.round(r.params.contHeight)!=Math.round(e)?i.log("live height@ not set"):r.params.loadedCount!=r.pageination.loadedCount?(r.params.loadedCount=r.pageination.loadedCount,r.pageination.scrolling=r.checkScrolling()):i.log("loaded - "+r.pageination.loadedCount))}}),r.imgLoaded=function(e,t){r.pageination.pagedItems[r.pageination.currentPage][e].show=!0},r.setLh=function(){n.path("/grs/"+r.params.grs).replace()},r.MasonryPositioning=function(){a["Masonry"+i.toUpperCaseFl(r.params.shatts.type)+"Positioning"](r.params,r.pageination,"")},r.grsShTC=function(){return i.grsShTC(r.params.shatts.title,r.params.data.theme.masonry.masonryTEffect)},r.shVIc=function(e){return i.shVIc(r.pageination.pagedItems[r.pageination.currentPage][e])},r.grsOnhv=function(){return i.grsOnhv(r.params.shatts.title)?"grsTOnhover":""},r.grsShMC=function(){return i.grsShMC(r.params.shatts.title,r.params.data.theme.masonry.masonryTEffect)},r.getImageSrc=function(e){var t=r.pageination.pagedItems[r.pageination.currentPage][e];return i.getImageSource(t,"masonry")},r.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+r.params.grs).offset().top-100},500)},r.CheckGrsHash=function(){var e=o.location.hash,t=r.params.grs,a=!1;if(-1!==e.indexOf("grs")){var i=e.split("/");if(i[2]==t&&3<i.length){imageId=i.pop();for(var n=0;n<r.pageination.pagedItems[0].length;n++)if(r.pageination.pagedItems[0][n].id==imageId){a=!0;break}a?r.clickAction(n):r.clickAction("hash-"+imageId)}}},r.$watch(function(){return i.settingsReady},function(e,t){e&&a.getGalleryData(0,r.pageination.itemsPerPage,r.params.shatts.id,1,r.params.shatts.orderby,r.params.shatts.ordering,r.params.shatts.theme,r.params.shatts.view).then(function(e){r.pageination.gallExists=e.data.gallExists,r.pageination.loading=!1,r.params.data.theme.masonry=JSON.parse(e.data.theme.masonry),r.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),r.pageination.pagedItems[0]=e.data.images,r.pageination.totalcount=e.data.count,r.pageination.pagesCount=Math.ceil(r.pageination.totalcount/r.pageination.itemsPerPage),r.pageination.loadedCount=0<r.pageination.pagesCount?1:0,r.pageination.gallExists&&(r.pageination.positioning(),r.CheckGrsHash())},function(e){i.log(e)})},!0)}}}]),grsApp.directive("grsCarousel3d",["$filter","GrsFactory","GrsService","$window","$location","$interval",function(e,a,u,r,i,o){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:u.getViewsTemplateUrl("grsCarousel3d"),link:function(d,e,t){d.sortingOrder="id",d.reverse=!0,d.message={type:"success",show:!1,text:""},d.params.contHeight=50,d.params.flp=0,d.params.contHeightFirstBinding=!1,d.params.loadedCount=0,d.params.scrollWaitInterval=110,d.params.lastScrollTime=(new Date).getTime(),d.params.currentImageIndexes={local:0,page:0,image:0},d.params.clickedImageIndexes={local:-1,page:0,image:0},d.params.scrollToThe="nothing",d.params.firstViewIsDone=!1,d.params.totalCountIsLess=!1,d.pageination={pN:0,forGallery:!0,grs:d.params.grs,items:[],navView:"scrolling",gallery:d.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(d.params.shatts.imagesperpage),orderBy:d.params.shatts.orderby,ordering:d.params.shatts.ordering,pagedItems:[],viewItemsCount:parseInt(d.params.shatts.viewitemscount),viewItems:[],loading:!0,positioning:function(){a.Carousel3dPositioning(d.params,this,d.scrollToImage,d.moveCC)},message:function(e,t,a){d.message.show=e,d.message.text=t,d.message.type=angular.isUndefined(a)?"success":a},checkScrolling:function(){return u.log("ekanq mas scrolling"),d.checkScrolling()},getRightDoorIndex:function(){return(d.params.currentImageIndexes.local+Math.ceil(this.viewItemsCount/2)-1)%this.viewItemsCount},getLeftDoorIndex:function(){var e=this.getRightDoorIndex();return e+1>=this.viewItemsCount?0:e+1},getPrevImgIndexes:function(e,t){var a,i;return i=0==t?0==e?(a=Math.ceil(d.pageination.totalcount/d.pageination.itemsPerPage)-1,d.pageination.totalcount-d.pageination.itemsPerPage*a-1):(a=e-1,d.pageination.itemsPerPage-1):(a=e,t-1),{page:a,image:i}},getNextImgIndexes:function(e,t){var a,i;return currentPageLength=e==Math.ceil(d.pageination.totalcount/d.pageination.itemsPerPage)-1?d.pageination.totalcount-d.pageination.itemsPerPage*e:d.pageination.itemsPerPage,i=t==currentPageLength-1?(a=e==Math.ceil(d.pageination.totalcount/d.pageination.itemsPerPage)-1?0:e+1,0):(a=e,t+1),{page:a,image:i}}},d.moveLeft=function(e){void 0!==e&&e.preventDefault(),d.moveCC("left")},d.moveRight=function(e){void 0!==e&&e.preventDefault(),d.moveCC("right")},d.moveCC=function(e){var t,a,i,n,r=d.pageination.viewItems,o=r.length,s=d.params.currentImageIndexes.local,g=d.pageination.getRightDoorIndex(),h=d.pageination.getLeftDoorIndex();if("left"===e){n={css:r[g].picCSS,params:r[g].params,indexes:r[g].indexes};var l,p=d.pageination.getNextImgIndexes(n.indexes.page,n.indexes.image);if(void 0===d.pageination.pagedItems[p.page]||void 0===d.pageination.pagedItems[p.page][p.image])return d.pageination.pN=p.page,u.log("Scrolling to left. Need page="+p.page+",image="+p.image),!(d.params.scrollToThe="left");for(d.pageination.totalcount==d.pageination.viewItemsCount-1||d.pageination.totalcount==d.pageination.viewItemsCount&&!d.params.totalCountIsLess||d.params.totalCountIsLess?(l=angular.copy(d.pageination.pagedItems[p.page][p.image])).nId=(new Date).getUTCMilliseconds():l=d.pageination.pagedItems[p.page][p.image],t={css:r[o-1].picCSS,params:r[o-1].params},a=o-1;-1<a;a--)i=a-1<0?o-1:a-1,r[a].params=i==o-1?(r[a].picCSS=t.css,t.params):(r[a].picCSS=r[i].picCSS,r[i].params);g=(g+1)%o,l.picCSS=n.css,l.params=n.params,l.indexes={page:p.page,image:p.image},r[g]=l,s=(d.params.currentImageIndexes.local+1)%o}else if("right"===e){n={css:r[h].picCSS,params:r[h].params,indexes:r[h].indexes};var m,c=d.pageination.getPrevImgIndexes(n.indexes.page,n.indexes.image);if(void 0===d.pageination.pagedItems[c.page]||void 0===d.pageination.pagedItems[c.page][c.image])return d.pageination.pN=c.page,u.log("Scrolling to right. Need page="+c.page),!(d.params.scrollToThe="right");for(d.pageination.totalcount==d.pageination.viewItemsCount-1||d.pageination.totalcount==d.pageination.viewItemsCount&&!d.params.totalCountIsLess||d.params.totalCountIsLess?(m=angular.copy(d.pageination.pagedItems[c.page][c.image]),c.nId=(new Date).getUTCMilliseconds()):m=d.pageination.pagedItems[c.page][c.image],t={css:r[0].picCSS,params:r[0].params},a=0;a<o;a++)i=a+1==o?0:a+1,r[a].params=0==i?(r[a].picCSS=t.css,t.params):(r[a].picCSS=r[i].picCSS,r[i].params);h=0==h?o-1:h-1,m.picCSS=n.css,m.params=n.params,m.indexes={page:c.page,image:c.image},r[h]=m,s=d.params.currentImageIndexes.local-1<0?o-1:d.params.currentImageIndexes.local-1}return d.params.currentImageIndexes={local:s,page:r[s].indexes.page,image:r[s].indexes.image},d.params.clickedImageIndexes.local==d.params.currentImageIndexes.local&&(d.params.clickedImageIndexes.local=-1),d.params.scrollToThe="nothing",!0},d.scrollToImage=function(e,t){if(!(e<0)){d.pageination.viewItems;var a,i=d.pageination.viewItemsCount,n=0;if(e>d.params.currentImageIndexes.local?n=e-d.params.currentImageIndexes.local<i/2?(a="left",e-d.params.currentImageIndexes.local):(a="right",i-(e-d.params.currentImageIndexes.local)):e<d.params.currentImageIndexes.local&&(n=d.params.currentImageIndexes.local-e<=i/2?(a="right",d.params.currentImageIndexes.local-e):(a="left",i-(d.params.currentImageIndexes.local-e))),!0===t)var r=o(function(){n--<=0?o.cancel(r):d.moveCC(a)||o.cancel(r)},d.params.scrollWaitInterval);else for(;0<n--;)d.moveCC(a)}},"scroll"!==d.params.shatts.nav&&"both"!==d.params.shatts.nav||e.find(".grsCarousel3d").bind("mousewheel DOMMouseScroll",function(e){var t=(new Date).getTime();if(t-d.params.lastScrollTime>=d.params.scrollWaitInterval){d.params.lastScrollTime=t;var a=e.originalEvent.wheelDelta,i=e.originalEvent.deltaY||e.originalEvent.detail;angular.isUndefined(a)?angular.isUndefined(i)||(0<i?d.moveCC("left"):d.moveCC("right")):0<a?d.moveCC("right"):d.moveCC("left")}e.preventDefault(),d.$$phase||d.$apply()}),d.clickAction=function(e,t,a,i){void 0!==i&&i.preventDefault(),!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a&&(d.params.clickedImageIndexes={local:e,page:t,image:a},d.scrollToImage(e,!0)),d["clickAction"+d.params.shatts.clickaction](e,t,a)},d.clickActiondoNothing=function(){},d.clickActionopenLightbox=function(e,t,a){var i,n,r=d.params,o=d.pageination;n=!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a?(i=d.pageination.viewItems[e].indexes.page,d.pageination.viewItems[e].indexes.image):(i=o.currentPage,e),d.setLh(),u.setPopObj({show:!0,grs:r.grs,gallId:r.shatts.id,shatts:r.shatts,theme:r.data.theme.lightbox,orderby:r.shatts.orderby,ordering:r.shatts.ordering,items:[],pI:o.pagedItems,cP:i,pC:o.pagesCount,tC:o.totalcount,lC:o.loadedCount,index:n})},d.clickActionopenLink=function(e,t,a){!isNaN(parseFloat(e))&&isFinite(e)&&void 0!==t&&void 0!==a?u.link(d.pageination.viewItems[e],d.params.shatts.openlinktarget):u.link(d.pageination.pagedItems[d.pageination.currentPage][e],d.params.shatts.openlinktarget)},d.$on("resize::resize",function(){d.pageination.gallExists&&(d.pageination.positioning(),d.$$phase||d.$apply())}),d.imgLoaded=function(e,t){d.pageination.viewItems[e].show=!0},d.setLh=function(){i.path("/grs/"+d.params.grs).replace()},d.navType=function(){var e=d.params.shatts.nav;return"both"===e||"buttons"===e},d.grsShTC=function(){return u.grsShTC(d.params.shatts.title,d.params.data.theme.carousel3d.crs3dThumbTEffect)},d.grsOnhv=function(){return u.grsOnhv(d.params.shatts.title)?"grsTOnhover":""},d.shVIc=function(e){return u.shVIc(d.pageination.viewItems[e])},d.grsShMC=function(){return u.grsShMC(d.params.shatts.title,d.params.data.theme.carousel3d.crs3dThumbTEffect)},d.shCarousel3d=function(){return 0<d.pageination.loadedCount},d.getImageSrc=function(e){var t=d.pageination.viewItems[e].indexes.page,a=d.pageination.viewItems[e].indexes.image,i=d.pageination.pagedItems[t][a];return p=d.params,i.thumbWidth=p.thumbWidth,i.thumbHeight=p.thumbHeight,u.getImageSource(i,"thumbnail")},d.CheckGrsHash=function(){var e=r.location.hash,t=d.params.grs,a=!1;if(-1!==e.indexOf("grs")){var i=e.split("/");if(i[2]==t&&3<i.length){imageId=i.pop();for(var n=0;n<d.pageination.pagedItems[0].length;n++)if(d.pageination.pagedItems[0][n].id==imageId){a=!0;break}a?d.clickAction(n):d.clickAction("hash-"+imageId)}}},d.$watch(function(){return u.settingsReady},function(e,t){e&&a.getGalleryData(0,d.pageination.itemsPerPage,d.params.shatts.id,1,d.params.shatts.orderby,d.params.shatts.ordering,d.params.shatts.theme,d.params.shatts.view).then(function(e){if(u.log(e),d.pageination.gallExists=e.data.gallExists,d.params.data.theme.carousel3d=JSON.parse(e.data.theme.carousel3d),d.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),d.pageination.pagedItems[0]=e.data.images,d.pageination.totalcount=parseInt(e.data.count),d.pageination.totalcount<=d.pageination.viewItemsCount&&(d.params.totalCountIsLess=!0,d.pageination.viewItemsCount=d.pageination.totalcount),d.pageination.pagesCount=Math.ceil(d.pageination.totalcount/d.pageination.itemsPerPage),d.pageination.loadedCount=0<d.pageination.pagesCount?1:0,d.pageination.gallExists){if(d.pageination.pagesCount<2)return d.pageination.loading=!1,a.Carousel3dPositioning(d.params,d.pageination),void d.CheckGrsHash();var t=Math.ceil(d.pageination.totalcount/d.pageination.itemsPerPage)-1;a.getGalleryData(t,d.pageination.itemsPerPage,d.params.shatts.id,0,d.params.shatts.orderby,d.params.shatts.ordering,d.params.shatts.theme,d.params.shatts.view).then(function(e){if(d.pageination.pagedItems[t]=e.data.images,d.pageination.pagedItems[t].length>=Math.floor(d.pageination.viewItemsCount/2))return d.pageination.loading=!1,a.Carousel3dPositioning(d.params,d.pageination),void d.CheckGrsHash();2<d.pageination.pagesCount?a.getGalleryData(t-1,d.pageination.itemsPerPage,d.params.shatts.id,0,d.params.shatts.orderby,d.params.shatts.ordering,d.params.shatts.theme,d.params.shatts.view).then(function(e){d.pageination.pagedItems[t-1]=e.data.images,d.pageination.loading=!1,a.Carousel3dPositioning(d.params,d.pageination),d.CheckGrsHash()},function(e){u.log(e)}):(d.pageination.loading=!1,a.Carousel3dPositioning(d.params,d.pageination),d.CheckGrsHash())},function(e){u.log(e)})}},function(e){u.log(e)})},!0)}}}]),grsApp.directive("grsThumbnail",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,i,o,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:i.getViewsTemplateUrl("grsThumbnail"),link:function(r,t,e){r.sortingOrder="id",r.reverse=!0,r.message={type:"success",show:!1,text:""},i.log(r.params),r.params.contHeight=50,r.params.contHeightFirstBinding=!1,r.params.loadedCount=0,r.pageination={pN:0,forGallery:!0,grs:r.params.grs,items:[],navView:r.params.shatts.pagination,gallery:r.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(r.params.shatts.imagesperpage),orderBy:r.params.shatts.orderby,ordering:r.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){a.ThumbnailPositioning(r.params,this,"")},message:function(e,t,a){r.message.show=e,r.message.text=t,r.message.type=void 0!==a?a:"success"},checkScrolling:function(){return i.log("ekanq mas scrolling"),r.checkScrolling()}},r.clickAction=function(e,t){void 0!==t&&t.preventDefault(),r["clickAction"+r.params.shatts.clickaction](e)},r.clickActiondoNothing=function(){},r.clickActionopenLightbox=function(e){var t=r.params,a=r.pageination;r.setLh(),i.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},r.clickActionopenLink=function(e){i.link(r.pageination.pagedItems[r.pageination.currentPage][e],r.params.shatts.openlinktarget)},r.$on("resize::resize",function(){r.pageination.gallExists&&(r.pageination.positioning(),r.$$phase||r.$apply())}),r.$on("scroll::scroll",function(){if("scrolling"===r.pageination.navView&&!r.pageination.loading){var e=jQuery("#grsGal"+r.params.grs),t=e.offset().top+e.innerHeight(),a=o.innerHeight;a/100<o.pageYOffset+a-t?(r.pageination.scrolling=!0,i.log("thumb mek 10ic ancanq")):r.pageination.scrolling=!1,r.$$phase||r.$apply()}}),r.checkScrolling=function(){if("scrolling"===r.pageination.navView){var e=jQuery("html").innerHeight();if(o.innerHeight>=e||o.pageYOffset+o.innerHeight>e){var t=r.pageination.scrolling?r.pageination.scrolling:2;return t*t}return!1}},r.$watch(function(){if("scrolling"===r.pageination.navView&&!r.pageination.loading){var e=t.find(".grsImsCont").innerHeight();0!=e?Math.round(r.params.contHeight)===Math.round(e)?r.params.loadedCount!=r.pageination.loadedCount&&(r.params.loadedCount=r.pageination.loadedCount,r.pageination.scrolling=r.checkScrolling()):i.log("live height@ not set"):i.log("Height watcher , gallCont@ der live height chuni")}}),r.imgLoaded=function(e,t){r.pageination.pagedItems[r.pageination.currentPage][e].show=!0},r.setLh=function(){n.path("/grs/"+r.params.grs).replace()},r.polOn=function(e){return parseInt(r.params.shatts.polaroid)?e%3==0?"pol_0 pol":(e%3==1?"pol_1":"pol_2")+" pol":""},r.grsShTC=function(){return i.grsShTC(r.params.shatts.title,r.params.data.theme.thumbnail.thumbnailTEffect)},r.grsOnhv=function(){return i.grsOnhv(r.params.shatts.title)?"grsTOnhover":""},r.shVIc=function(e){return i.shVIc(r.pageination.pagedItems[r.pageination.currentPage][e])},r.grsShMC=function(){return i.grsShMC(r.params.shatts.title,r.params.data.theme.thumbnail.thumbnailTEffect)},r.getImageSrc=function(e){var t=r.pageination.pagedItems[r.pageination.currentPage][e];return i.getImageSource(t,"thumbnail")},r.CheckGrsHash=function(){var e=o.location.hash,t=r.params.grs,a=!1;if(-1!==e.indexOf("grs")){var i=e.split("/");if(i[2]==t&&3<i.length){imageId=i.pop();for(var n=0;n<r.pageination.pagedItems[0].length;n++)if(r.pageination.pagedItems[0][n].id==imageId){a=!0;break}a?r.clickAction(n):r.clickAction("hash-"+imageId)}}},r.$watch(function(){return i.settingsReady},function(e,t){e&&a.getGalleryData(0,r.pageination.itemsPerPage,r.params.shatts.id,1,r.params.shatts.orderby,r.params.shatts.ordering,r.params.shatts.theme,r.params.shatts.view).then(function(e){i.log(e),r.pageination.gallExists=e.data.gallExists,r.pageination.loading=!1,r.params.data.theme.thumbnail=JSON.parse(e.data.theme.thumbnail),r.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),r.pageination.pagedItems[0]=e.data.images,r.pageination.totalcount=e.data.count,r.pageination.pagesCount=Math.ceil(r.pageination.totalcount/r.pageination.itemsPerPage),r.pageination.loadedCount=0<r.pageination.pagesCount?1:0,r.pageination.gallExists&&(r.pageination.positioning(),r.CheckGrsHash())},function(e){i.log(e)})},!0)}}}]),grsApp.directive("grsFilm",["$filter","GrsFactory","GrsService","$window","$location",function(e,a,c,r,i){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:c.getViewsTemplateUrl("grsFilm"),link:function(m,e,t){m.sortingOrder="id",m.reverse=!0,m.message={type:"success",show:!1,text:""},m.params.contHeight=50,m.params.flp=0,m.params.contHeightFirstBinding=!1,m.params.loadedCount=0,m.pageination={pN:0,forGallery:!0,grs:m.params.grs,items:[],navView:"scrolling",gallery:m.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(m.params.shatts.imagesperpage),orderBy:m.params.shatts.orderby,ordering:m.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){a.FilmPositioning(m.params,this,m.moveFC)},message:function(e,t,a){m.message.show=e,m.message.text=t,m.message.type=angular.isUndefined(a)?"success":a},checkScrolling:function(){return c.log("ekanq mas scrolling"),m.checkScrolling()}},m.hideNav=function(){var e=m.params,t=m.pageination;return!(t.pagesCount>t.loadedCount)&&e.contWidth+-1*e.flp>=e.flWidth},m.moveLeft=function(e){void 0!==e&&e.preventDefault(),m.moveFC("left")},m.moveRight=function(e){void 0!==e&&e.preventDefault(),m.moveFC("right")},m.moveFC=function(e){var t,a=m.params.flp,i=m.params,n=i.data.theme.film,r=i.flWidth,o=i.contWidth,s=parseInt(i.shatts.width)+parseInt(n.fmThumbMargin)+2*(parseInt(n.fmThumbPadding)+("none"!==n.fmThumbBorderStyle?parseInt(n.fmThumbBorderWidth):0)),g=c.settings.filmImMoveCount,h=Math.floor(Math.floor(o/s)/2),l=h<g?0===h?1:h:g;if("left"===e){if(r<=o+-1*a)return void(m.pageination.scrolling=!0);t=p(a-(r-(o+-1*a))%s,!1)}else if("right"===e){if(0===a)return;t=p(a+-1*a%s,!0)}function p(e,t){var a=t?-1*parseInt(e/s):parseInt((r-(o+-1*e))/s);if(0<a){var i=a<l?a:l;t?e+=i*s:e-=i*s}return e}m.params.flp=t},"scroll"!==m.params.shatts.nav&&"both"!==m.params.shatts.nav||e.find(".grsFilm").bind("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent.wheelDelta,a=e.originalEvent.deltaY||e.originalEvent.detail;angular.isUndefined(t)?angular.isUndefined(a)||(0<a?m.moveFC("left"):m.moveFC("right")):0<t?m.moveFC("right"):m.moveFC("left"),e.preventDefault(),m.$$phase||m.$apply()}),m.clickAction=function(e,t){void 0!==t&&t.preventDefault(),m["clickAction"+m.params.shatts.clickaction](e)},m.clickActiondoNothing=function(){},m.clickActionopenLightbox=function(e){var t=m.params,a=m.pageination;m.setLh(),c.setPopObj({show:!0,grs:t.grs,gallId:t.shatts.id,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.orderby,ordering:t.shatts.ordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},m.clickActionopenLink=function(e){c.link(m.pageination.pagedItems[m.pageination.currentPage][e],m.params.shatts.openlinktarget)},m.$on("resize::resize",function(){m.pageination.gallExists&&(m.pageination.positioning(),m.$$phase||m.$apply())}),m.imgLoaded=function(e,t){m.pageination.pagedItems[m.pageination.currentPage][e].show=!0},m.setLh=function(){i.path("/grs/"+m.params.grs).replace()},m.navType=function(){var e=m.params.shatts.nav;return"both"===e||"buttons"===e},m.grsShTC=function(){return c.grsShTC(m.params.shatts.title,m.params.data.theme.film.fmThumbTEffect)},m.grsOnhv=function(){return c.grsOnhv(m.params.shatts.title)?"grsTOnhover":""},m.shVIc=function(e){return c.shVIc(m.pageination.pagedItems[m.pageination.currentPage][e])},m.grsShMC=function(){return c.grsShMC(m.params.shatts.title,m.params.data.theme.film.fmThumbTEffect)},m.shFilm=function(){return 0<m.pageination.loadedCount},m.getImageSrc=function(e){var t=m.pageination.pagedItems[m.pageination.currentPage][e],a=m.params;return t.thumbWidth=a.thumbWidth,t.thumbHeight=a.thumbHeight,c.getImageSource(t,"thumbnail")},m.CheckGrsHash=function(){var e=r.location.hash,t=m.params.grs,a=!1;if(-1!==e.indexOf("grs")){var i=e.split("/");if(i[2]==t&&3<i.length){imageId=i.pop();for(var n=0;n<m.pageination.pagedItems[0].length;n++)if(m.pageination.pagedItems[0][n].id==imageId){a=!0;break}a?m.clickAction(n):m.clickAction("hash-"+imageId)}}},m.$watch(function(){return c.settingsReady},function(e,t){e&&a.getGalleryData(0,m.pageination.itemsPerPage,m.params.shatts.id,1,m.params.shatts.orderby,m.params.shatts.ordering,m.params.shatts.theme,m.params.shatts.view).then(function(e){c.log(e),m.pageination.gallExists=e.data.gallExists,m.pageination.loading=!1,m.params.data.theme.film=JSON.parse(e.data.theme.film),m.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),m.pageination.pagedItems[0]=e.data.images,m.pageination.totalcount=e.data.count,m.pageination.pagesCount=Math.ceil(m.pageination.totalcount/m.pageination.itemsPerPage),m.pageination.loadedCount=0<m.pageination.pagesCount?1:0,m.pageination.gallExists&&(a.FilmPositioning(m.params,m.pageination),m.CheckGrsHash())},function(e){c.log(e)})},!0)}}}]),grsApp.directive("grsAlbum",["$filter","GrsFactory","GrsService","$window","$location",function(e,m,c,o,s){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:c.getViewsTemplateUrl("grsAlbum"),link:function(p,a,e){p.message={type:"success",show:!1,text:""},p.grsHash=[],p.toUpperCaseFl=function(e){return c.toUpperCaseFl(e)},p.options={grsMainView:c.getViewsTemplateUrl("grsAlbum"+p.params.shatts.mainview),grsGalView:c.getViewsTemplateUrl("grs"+p.params.shatts.galview),albVerHor:"Thumbnail"!==p.params.shatts.mainview?p.toUpperCaseFl(p.params.shatts.masmostype):"",galVerHor:"Thumbnail"!==p.params.shatts.galview?p.toUpperCaseFl(p.params.shatts.galmasmostype):"",albumView:!0,albThRes:{},back:!1,eStack:[]},p.params.contHeight=50,p.params.contHeightFirstBinding=!1,p.params.loadedCount=0,p.params.albumView=p.options.albumView,p.messageF=function(e,t,a){p.message.show=e,p.message.text=t,p.message.type=angular.isUndefined(a)?"success":a},p.mainPageination={pN:0,forGallery:!1,grs:p.params.grs,items:[],navView:p.params.shatts.pagination,album:p.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(p.params.shatts.imagesperpage),orderBy:p.params.shatts.orderby,ordering:p.params.shatts.ordering,pagedItems:[],scrolling:!1,loading:!0,positioning:function(){m[p.params.shatts.mainview+p.options.albVerHor+"Positioning"](p.params,this,".grsAlbum")},message:p.messageF,checkScrolling:function(){return c.log("ekanq mas scrolling"),p.checkScrolling()}},p.pageination={pN:0,forGallery:!0,grs:p.params.grs,items:[],navView:p.params.shatts.pagination,gallery:0,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(p.params.shatts.imagesperpage),orderBy:p.params.shatts.galorderby,ordering:p.params.shatts.galordering,pagedItems:[],scrolling:!1,loading:!1,positioning:function(){m[p.params.shatts.galview+p.options.galVerHor+"Positioning"](p.params,this,"")},message:p.messageF,checkScrolling:function(){return c.log("ekanq album scrolling"),p.checkScrolling()}},p.$on("resize::resize",function(){(p.mainPageination.albExists||p.pageination.gallExists)&&(p.params.albumView=p.options.albumView,(p.options.albumView?p.mainPageination:p.pageination).positioning(),p.$$phase||p.$apply())}),p.$on("scroll::scroll",function(){if("scrolling"===p.mainPageination.navView){var e=p.options.albumView?p.mainPageination:p.pageination;if(!e.loading){var t=jQuery("#grsGal"+p.params.grs),a=t.offset().top+t.innerHeight(),i=o.innerHeight,n=o.pageYOffset+i;e.scrolling=i/10<n-a,p.$$phase||p.$apply()}}}),p.checkScrolling=function(){if("scrolling"===p.mainPageination.navView){var e=jQuery("html").innerHeight();if(o.innerHeight>=e||o.pageYOffset+o.innerHeight>e){var t=p.options.albumView?p.mainPageination.scrolling:p.pageination.scrolling;return newVal=t||2,newVal*newVal}return!1}},p.$watch(function(){if("scrolling"===p.mainPageination.navView){var e=p.options.albumView?p.mainPageination:p.pageination;if(!e.loading){var t=a.find(".grsImsCont").innerHeight();0!=t&&(Math.round(p.params.contHeight)!=Math.round(t)?c.log("live height@ not set"):p.params.loadedCount!=e.loadedCount?(p.params.loadedCount=e.loadedCount,e.scrolling=p.checkScrolling()):c.log("loaded - "+e.loadedCount))}}}),p.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+p.params.grs).offset().top-100},500)},p.grsShTC=function(){var e=p.options.albumView?"mainview":"galview",t=p.options.albumView?"title":"galtitle",a=p.params.shatts[e].toLowerCase()+"TEffect";return c.grsShTC(p.params.shatts[t],p.params.data.theme[p.params.shatts[e].toLowerCase()][a])},p.shVIc=function(e){return c.shVIc(p.pageination.pagedItems[p.pageination.currentPage][e])},p.grsShMC=function(){var e=p.options.albumView?"mainview":"galview",t=p.options.albumView?"title":"galtitle",a=p.params.shatts[e].toLowerCase()+"TEffect";return c.grsShMC(p.params.shatts[t],p.params.data.theme[p.params.shatts[e].toLowerCase()][a])},p.grsOnhv=function(){var e=p.options.albumView?"title":"galtitle";return c.grsOnhv(p.params.shatts[e])?"grsTOnhover":""},p.clickAction=function(e,t){void 0!==t&&t.preventDefault(),p["clickAction"+p.params.shatts.galclickaction](e)},p.clickActiondoNothing=function(){},p.clickActionopenLightbox=function(e){var t=p.params,a=p.pageination;p.setLh(),c.setPopObj({show:!0,grs:t.grs,gallId:a.gallery,shatts:t.shatts,theme:t.data.theme.lightbox,orderby:t.shatts.galorderby,ordering:t.shatts.galordering,items:[],pI:a.pagedItems,cP:a.currentPage,pC:a.pagesCount,tC:a.totalcount,lC:a.loadedCount,index:e})},p.clickActionopenLink=function(e){c.link(p.pageination.pagedItems[p.pageination.currentPage][e],p.params.shatts.galopenlinktarget)},p.imgLoaded=function(e,t){var a=p.options.albumView?"mainPageination":"pageination";p[a].pagedItems[p[a].currentPage][e].show=!0},p.setLh=function(){for(var e="/grs/"+p.params.grs,t=p.options.albumView,a=t?"album":"gallery",i=(t?p.mainPageination:p.pageination)[a],n=p.options.eStack,r=n.length,o=1;o<r;o++)e+="/album/"+n[o].albId;e=0!=r?e+"/"+a+"/"+i:"",s.path(e).replace()},p.CheckGrsHash=function(){var e=o.location.hash,t=p.params.grs;if(-1!==e.indexOf("grs")){var a=e.split("/");if(a[2]==t){for(var i=3,n=4;i<a.length;i+=2,n+=2)p.grsHash.push({type:a[i],id:a[n]});if(p.grsHash.length){p.grsHash=p.grsHash.reverse();var r=p.grsHash.pop();p.grsEnter(!1,!1,r.id,r.type)}}}},p.CheckGrsHashForPopup=function(){for(var e=p.grsHash.pop(),t=!1,a=0;a<p.pageination.pagedItems[0].length;a++)if(p.pageination.pagedItems[0][a].id==e.id){t=!0;break}t?p.clickAction(a):p.clickAction("hash-"+e.id)},p.grsEnter=function(e,t,a,i){t&&t.preventDefault();var n=p.mainPageination,r=p.pageination,o=n.album,s=n.currentPage,g=n.pagesCount,h=n.totalcount,l=i?"gallery"==i?"gal":"alb":n.pagedItems[n.currentPage][e].contentType;a=a||n.pagedItems[s][e].contentId;if(p.options.eStack.push({albId:o,cP:s,pC:g,tC:h}),n.loading=!0,p.params.loadedCount=0,"gal"===l)r.scrolling=!1,r.loadedCount=0,r.totalcount=-1,r.pagesCount=0,m.getGalleryData(0,r.itemsPerPage,a,1,p.params.shatts.galorderby,p.params.shatts.galordering,p.params.shatts.theme,p.params.shatts.galview).then(function(e){r.gallExists=e.data.gallExists,n.loading=!1,p.options.back=!0,p.options.albumView=!1,p.params.albumView=!1,r.gallery=a,p.params.data.theme[p.params.shatts.galview.toLowerCase()]=JSON.parse(e.data.theme[p.params.shatts.galview.toLowerCase()]),p.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),r.pagedItems=[],r.currentPage=0,r.pagedItems[0]=e.data.images,r.totalcount=e.data.count,r.pagesCount=Math.ceil(r.totalcount/r.itemsPerPage),r.loadedCount=0<r.pagesCount?1:0,r.positioning(),p.grsHash.length?p.CheckGrsHashForPopup():p.setLh()},function(e){c.log(e)});else{if("alb"!==l)return void c.log("Something went wrong.");n.scrolling=!1,n.loadedCount=0,n.totalcount=-1,n.pagesCount=0,m.getAlbumData(0,n.itemsPerPage,a,1,p.params.shatts.orderby,p.params.shatts.ordering,p.params.shatts.theme,p.params.shatts.mainview).then(function(e){if(n.albExists=e.data.albExists,n.loading=!1,p.options.back=!0,n.album=a,p.params.data.theme[p.params.shatts.mainview.toLowerCase()]=JSON.parse(e.data.theme[p.params.shatts.mainview.toLowerCase()]),p.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),n.pagedItems=[],n.currentPage=0,n.pagedItems[0]=e.data.content,n.totalcount=e.data.count,n.pagesCount=Math.ceil(n.totalcount/n.itemsPerPage),n.loadedCount=0<n.pagesCount?1:0,c.log("mtanq album "+n.loadedCount),n.positioning(),p.grsHash.length){var t=p.grsHash.pop();p.grsEnter(!1,!1,t.id,t.type)}else p.setLh()},function(e){c.log(e)})}p.scrollTop()},p.grsBack=function(e){e.preventDefault();var t=p.options.eStack.pop();if(!angular.isUndefined(t)){var a=p.options.albumView,i=a?p.mainPageination:p.pageination;a?i.album:i.gallery;i.loading=!0,p.mainPageination.album=t.albId,p.mainPageination.scrolling=!1,p.mainPageination.loadedCount=0,p.mainPageination.totalcount=-1,p.mainPageination.pagesCount=0,p.params.loadedCount=0,m.getAlbumData(t.cP,p.mainPageination.itemsPerPage,t.albId,0,p.params.shatts.orderby,p.params.shatts.ordering).then(function(e){p.mainPageination.albExists=e.data.albExists,i.loading=!1,0==p.options.eStack.length&&(p.options.back=!1),p.options.albumView=!0,p.params.albumView=!0,p.params.data.theme=p.options.albThRes,p.mainPageination.pagedItems=[],p.mainPageination.pagedItems[t.cP]=e.data.content,p.mainPageination.currentPage=t.cP,p.mainPageination.totalcount=t.tC,p.mainPageination.pagesCount=t.pC,p.mainPageination.loadedCount=0<p.mainPageination.pagesCount?1:0,p.mainPageination.positioning(),p.scrollTop(),p.setLh()},function(e){c.log(e)})}},p.getImageSrc=function(e){var t=p.options.albumView,a=t?"mainPageination":"pageination",i=t?p.params.shatts.mainview.toLowerCase():p.params.shatts.galview.toLowerCase(),n=p[a].pagedItems[p[a].currentPage][e];return"grsnopv"===n.name&&""===n.path?c.imagesDir+n.name+n.type:t?c.uploaderUrl+n.path+c.getImageVer(n.thumbWidth,n.thumbHeight,i)+n.name+n.type:c.getImageSource(n,i)},p.getTrans=c.getTrans,p.$watch(function(){return c.settingsReady},function(e,t){e&&m.getAlbumData(0,p.mainPageination.itemsPerPage,p.params.shatts.id,1,p.params.shatts.orderby,p.params.shatts.ordering,p.params.shatts.theme,p.params.shatts.mainview).then(function(e){p.mainPageination.albExists=e.data.albExists,p.mainPageination.loading=!1,p.params.data.theme[p.params.shatts.mainview.toLowerCase()]=JSON.parse(e.data.theme[p.params.shatts.mainview.toLowerCase()]),p.params.data.theme.lightbox=JSON.parse(e.data.theme.lightbox),p.options.albThRes=p.params.data.theme,p.mainPageination.album=p.params.shatts.id,p.mainPageination.pagedItems[0]=e.data.content,p.mainPageination.totalcount=e.data.count,p.mainPageination.pagesCount=Math.ceil(p.mainPageination.totalcount/p.mainPageination.itemsPerPage),p.mainPageination.loadedCount=0<p.mainPageination.pagesCount?1:0,p.mainPageination.albExists&&(p.mainPageination.positioning(),p.CheckGrsHash())},function(e){c.log(e)})},!0)}}}]),grsApp.directive("grsNav",["$filter","$compile","$parse","GrsFactory","GrsService",function(a,e,t,i,r){return{restrict:"E",transclude:!0,scope:{pageInation:"="},template:'<div ng-include="options.grsNavView" class="grsNavInc"></div>',link:function(n,e,t){n.options={showNav:!1},n.$watch("pageInation.navView",function(){n.options.grsNavView="scrolling"!==n.pageInation.navView&&"none"!==n.pageInation.navView?r.getViewsTemplateUrl("grsPagenav"+n.pageInation.navView):""},!0),n.$watch("pageInation.totalcount",function(){var e=0==n.pageInation.totalcount,t=n.pageInation.forGallery?n.getTrans("text_077"):n.getTrans("text_078");t=n.pageInation.forGallery&&!n.pageInation.gallExists?n.getTrans("text_079"):t,t=n.pageInation.forGallery||n.pageInation.albExists?t:n.getTrans("text_080");n.pageInation.message(e,t,"error")},!0),n.$watch("pageInation.scrolling",function(){r.log("ekanq scrollingi watcher grsNavum"),r.log("watcher-i arjeq@ "+n.pageInation.scrolling),n.pageInation.scrolling&&(r.log("ekanq scrolling loadmore"),n.loadMore())},!0);n.$watch("pageInation.pagesCount",function(){void 0!==n.pageInation.pagedItems&&void 0!==n.pageInation.pagesCount&&n.showNavF()}),n.$watch("pageInation.pN",function(){0!=n.pageInation.pN&&(n.checkPage(n.pageInation.pN),r.log(n.pageInation.pN+" page is loading!"))},!0),n.search=function(){n.pageInation.filteredItems=a("filter")(n.pageInation.items,function(e){for(var t in e)if(a=e[t],!(i=n.query)||-1!==a.toLowerCase().indexOf(i.toLowerCase()))return!0;var a,i;return!1}),n.pageInation.currentPage=0,n.groupToPages()},n.groupToPages=function(){n.pageInation.pagedItems=[];for(var e=0;e<n.pageInation.filteredItems.length;e++)e%n.pageInation.itemsPerPage==0?n.pageInation.pagedItems[Math.floor(e/n.pageInation.itemsPerPage)]=[n.pageInation.filteredItems[e]]:n.pageInation.pagedItems[Math.floor(e/n.pageInation.itemsPerPage)].push(n.pageInation.filteredItems[e])},n.range=function(e,t){var a=[];t||(t=e,e=0);for(var i=e;i<t;i++)a.push(i);return a},n.getForGallery=function(t){n.pageInation.loading=!0,i.getGalleryData(t,n.pageInation.itemsPerPage,n.pageInation.gallery,0,n.pageInation.orderBy,n.pageInation.ordering).then(function(e){n.pageInation.loading=!1,n.pageInation.pagedItems[t]=e.data.images,n.pageInation.currentPage=t,n.pageInation.positioning()},function(e){r.log(e)})},n.getForAlbum=function(t){n.pageInation.loading=!0,i.getAlbumData(t,n.pageInation.itemsPerPage,n.pageInation.album,0,n.pageInation.orderBy,n.pageInation.ordering).then(function(e){n.pageInation.loading=!1,n.pageInation.pagedItems[t]=e.data.content,n.pageInation.currentPage=t,n.pageInation.positioning()},function(e){r.log(e)})},n.checkPage=function(e){void 0===n.pageInation.pagedItems[e]?void 0!==n.pageInation.forGallery&&n.pageInation.forGallery?n.getForGallery(e):void 0===n.pageInation.forGallery||n.pageInation.forGallery?r.log("Something went wrong."):n.getForAlbum(e):(n.pageInation.currentPage=e,n.pageInation.positioning()),jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+n.pageInation.grs).offset().top-100},500)},n.prevPage=function(){if(0<n.pageInation.currentPage){var e=n.pageInation.currentPage;n.checkPage(--e)}},n.loadMore=function(e){void 0!==e&&e.preventDefault(),n.pageInation.loading?r.log("Loading in progress"):n.pageInation.loadedCount!=n.pageInation.pagesCount&&0!=n.pageInation.pagesCount?angular.isUndefined(n.pageInation.pagedItems[0])?r.log("Problem with first load"):void 0!==n.pageInation.forGallery&&n.pageInation.forGallery?(n.pageInation.loading=!0,n.pageInation.scrolling=!1,i.getGalleryData(n.pageInation.loadedCount,n.pageInation.itemsPerPage,n.pageInation.gallery,0,n.pageInation.orderBy,n.pageInation.ordering).then(function(e){n.pageInation.loading=!1,n.pageInation.loadedCount+=1,n.pageInation.pagedItems[0]=n.pageInation.pagedItems[0].concat(e.data.images),n.pageInation.positioning(),n.showNavF()},function(e){r.log(e)})):void 0===n.pageInation.forGallery||n.pageInation.forGallery||(n.pageInation.loading=!0,n.pageInation.scrolling=!1,i.getAlbumData(n.pageInation.loadedCount,n.pageInation.itemsPerPage,n.pageInation.album,0,n.pageInation.orderBy,n.pageInation.ordering).then(function(e){n.pageInation.loading=!1,n.pageInation.loadedCount+=1,n.pageInation.pagedItems[0]=n.pageInation.pagedItems[0].concat(e.data.content),n.pageInation.positioning(),n.showNavF()},function(e){r.log(e)})):r.log("Already all is loaded")},n.nextPage=function(){if(n.pageInation.currentPage<n.pageInation.pagesCount-1){var e=n.pageInation.currentPage;n.checkPage(++e)}},n.lastPage=function(){if(n.pageInation.currentPage<n.pageInation.pagesCount-1){var e=n.pageInation.pagesCount-1;n.checkPage(e)}},n.firstPage=function(){if(0<n.pageInation.currentPage){n.checkPage(0)}},n.setPage=function(){var e=this.n;n.checkPage(e)},n.showNavF=function(){r.log("loaded count - "+n.pageInation.loadedCount),r.log("pagesCount count - "+n.pageInation.pagesCount),"numbers"!=n.pageInation.navView?n.options.showNav=n.pageInation.loadedCount!=n.pageInation.pagesCount&&0!=n.pageInation.pagesCount:n.options.showNav=1!=n.pageInation.pagesCount&&0!=n.pageInation.pagesCount},n.getTrans=r.getTrans}}}]),grsApp.factory("GrsFactory",["$http","$q","GrsService",function(h,l,O){return{getGalleryData:function(e,t,a,i,n,r,o,s){var g={action:"grsGalleryAjax",grsAction:"getGalleryData",id:a,start:e,count:t,orderBy:n,ordering:r,firstRequest:i,theme:i?o:0,view:i?s:""};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(g),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},getAlbumData:function(e,t,a,i,n,r,o,s){var g={action:"grsGalleryAjax",grsAction:"getAlbumData",id:a,start:e,count:t,orderBy:n,ordering:r,firstRequest:i,theme:i?o:0,view:i?s:""};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(g),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},getPopupData:function(e,t,a,i,n){var r={action:"grsGalleryAjax",grsAction:"getPopupData",id:e,offsets:t,perPage:a,orderBy:i,ordering:n};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},getSettings:function(){var e={action:"grsGalleryAjax",grsAction:"getSettingsForF"};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(e),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},getEffects:function(){return h.get(O.effectsJsonUrl).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},getImgComm:function(e,t){var a={action:"grsGalleryAjax",grsAction:"showComments",id:e,gallId:t};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},postIc:function(e,t,a,i,n,r){var o={action:"grsGalleryAjax",grsAction:"comment",name:e,captchaCode:t,email:a,comment:i,imageId:n,galId:r};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},reloadCap:function(e,t,a){var i={action:"grsGalleryAjax",grsAction:"reloadCaptcha"};return h({method:"POST",url:grsAjaxUrl,data:jQuery.param(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return l.resolve(e)},function(e){return O.log("errr"),l.reject(e)})},ThumbnailPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),o=n==r,s=0,g=e.data.theme.thumbnail,h=parseInt(g.thumbnailmargin),l="none"!=g.thumbnailBorderStyle?2*parseInt(g.thumbnailBorderWidth):0,p=[],m=[];l+=2*parseInt(g.thumbnailpadding);var c=Math.round(parseInt(i+h)/(n+l+h));if(c<1&&(c=1),n=(i+h-(c=t.pagedItems[t.currentPage].length<c?t.pagedItems[t.currentPage].length:c)*(l+h))/c,0!=c&&0!=t.pagedItems[t.currentPage].length){for(var d=0;d<c;d++)m[d]=[],p[d]=0;r=o?n:r;for(var u=0;u<t.pagedItems[t.currentPage].length;u++){t.pagedItems[t.currentPage][u].thumbHeight=r,t.pagedItems[t.currentPage][u].thumbWidth=n;var f=Math.min.apply(Math,p),v=p.indexOf(f);p[v]+=r+l+h,m[v].push(t.pagedItems[t.currentPage][u])}var w=Math.max.apply(Math,p),I=p.indexOf(w),b=0;s+=p[I]-h;for(u=0;u<m.length;u++){var C=0;for(d=0;d<m[u].length;d++)m[u][d].left=b,m[u][d].top=C,C+=m[u][d].thumbHeight+l+h;b+=n+l+h}i=b-h,e.contWidth=i,e.contHeight=s}else e.contHeight=50},FilmPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width(),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),s=e.data.theme.film,g=parseInt(s.fmThumbMargin),h=parseInt(s.fmMargin),l="none"!==s.fmThumbBorderStyle?parseInt(s.fmThumbBorderWidth):0,p=parseInt(s.fmThumbPadding);e.contWidth=i*(n/100),e.thumbWidth=r,e.thumbHeight=o,e.contHeight=o+2*(h+p+l),e.flHeight=o+2*(p+l),e.flWidth=t.pagedItems[t.currentPage].length*(r+g+2*(p+l))+g,a&&a("left")},Carousel3dPositioning:function(e,t,a,i){var n,r=jQuery("#grsGal"+e.grs).parent().width(),o=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),s=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),g=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),h=e.data.theme.carousel3d,l=("none"!==h.crs3dThumbBorderStyle&&parseInt(h.crs3dThumbBorderWidth),parseInt(h.crs3dThumbPadding),parseInt(h.crs3dThumbBoxshadowThdVal)?7:0);n=700<r?1:600<r?.9:490<r?.8:420<r?.7:360<r?.6:.5,r*=o/100;var p=n*parseFloat(e.shatts.minscale),m=n*parseFloat(e.shatts.maxscale),c=parseFloat(e.shatts.rightdepth),d=parseFloat(e.shatts.leftdepth),u=t.getRightDoorIndex(),f=t.getLeftDoorIndex();if(!e.firstViewIsDone){var v,w,I,b=[];v={page:"object"==typeof b[u]&&"indexes"in b[u]?b[u].indexes.page:Math.floor(u/t.itemsPerPage),image:"object"==typeof b[u]&&"indexes"in b[u]?b[u].indexes.image:u%t.itemsPerPage};for(w=u,I=0;I<t.viewItemsCount;I++,w=w-1<0?t.viewItemsCount-1:w-1){if(void 0===t.pagedItems[v.page]||void 0===t.pagedItems[v.page][v.image])return void(t.pN=v.page);b[w]=t.pagedItems[v.page][v.image],b[w].indexes={page:v.page,image:v.image},v=t.getPrevImgIndexes(v.page,v.image)}t.viewItems=b}var C,y,x,P,S,k,A,T,E,M,H,V,F,L,$,G,W=t.viewItems,O=W.length,N=(p+m)/2,U=(r-N*(s+2*l))/2,D=O,R=2*Math.PI/O,z=-Math.PI/2,j=Math.atan((p-m)*(s+2*l)/(4*U)),B=p+(1-Math.sin(j))*(m-p)/2,_=(2*(U-=U*Math.cos(j)+B*(s+2*l)/2-(U+N*(s+2*l)/2))+s-r)/2,q=0;if(d*c<0)S=(T=((V=1)-p)*g/2)+p*g,k=(E=(1-m)*g/2+2*U*(0<d?d:c))+m*g,A=(M=(1-p)*g/2+(F=2*U*Math.abs(d-c)))+p*g,H=Math.abs(Math.max(S,k,A)-Math.min(T,E,M))+2*l,q=Math.min(T,E,M)-l;else if(0<d*c&&0<d)L=(V=2)*U*Math.abs(d-c),S=(T=(1-p)*g/2)+p*g,k=(E=(1-m)*g/2+2*U*($=Math.max(d,c)))+m*g,A=(M=(1-p)*g/2+L)+p*g,H=Math.abs(Math.max(S,k,A)-Math.min(T,E,M))+2*l,q=Math.min(T,E,M)-l;else if(0<d*c&&d<0){V=3,L=2*U*Math.abs(d-c);var Q=2*U*-($=Math.max(d,c));S=(T=(1-p)*g/2+Q)+p*g,k=(E=(1-m)*g/2)+m*g,A=(M=(1-p)*g/2+L+Q)+p*g,H=Math.abs(Math.max(S,k,A)-Math.min(T,E,M))+2*l,q=Math.min(T,E,M)-l-Q}else d*c==0&&(V=4,A=0<d||0<c?(S=(T=(1-p)*g/2)+p*g,k=(E=(1-m)*g/2+(F=2*U*(0<d?d:c)))+m*g,(M=(1-p)*g/2+F)+p*g):d<0||c<0?(S=(T=(1-p)*g/2)+p*g,k=(E=(1-m)*g/2)+m*g,(M=(1-p)*g/2+(F=2*U*-(d<0?d:c)))+p*g):(F=0,S=(T=(1-p)*g/2)+p*g,k=(E=(1-m)*g/2)+m*g,(M=(1-p)*g/2)+p*g),H=Math.abs(Math.max(S,k,A)-Math.min(T,E,M))+2*l,q=Math.min(T,E,M)-l);var Y,J,X,K=Math.round(Math.PI/2*1e6)/1e6;for(w=0;w<O;w++){switch(e.firstViewIsDone&&(z=W[w].params.alpha),G=Math.round(1e6*z)/1e6<K?c:d,C=U*(1+Math.cos(z))-_,y=(x=U*(1-Math.sin(z)))*G-q,V){case 1:y+=G<0?F:0;break;case 2:case 3:y+=G<$?L:0;break;case 4:y+=(0==G&&0<Math.max(d,c)?F:0)+(G<0?F:0)}P=p+x*(m-p)/(2*U),e.firstViewIsDone?W[w].params={x:C,y:y,z:x,scale:P,alpha:W[w].params.alpha,zIndex:W[w].params.zIndex}:(W[w].params={x:C,y:y,z:x,scale:P,alpha:z,zIndex:0},w<=O/2?w<1?W[w].params.zIndex=D--:(W[w].params.zIndex=D,D-=2):O-w in W&&(W[w].params.zIndex=W[O-w].params.zIndex-1)),W[w].picCSS={width:s+"px",height:g+"px","z-index":W[w].params.zIndex,"-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+W[w].params.x+"px,"+W[w].params.y+"px,"+W[w].params.z+"px) scale("+W[w].params.scale+")","-moz-transform":"translate3d("+W[w].params.x+"px,"+W[w].params.y+"px,"+W[w].params.z+"px) scale("+W[w].params.scale+")","-ms-transform:":"translate3d("+W[w].params.x+"px,"+W[w].params.y+"px,"+W[w].params.z+"px) scale("+W[w].params.scale+")","-o-transform:":"translate3d("+W[w].params.x+"px,"+W[w].params.y+"px,"+W[w].params.z+"px) scale("+W[w].params.scale+")",transform:"translate3d("+W[w].params.x+"px,"+W[w].params.y+"px,"+W[w].params.z+"px) scale("+W[w].params.scale+")"},e.firstViewIsDone||(z+=R)}if(e.crs3dWidth=r,e.crs3dHeight=H,e.contWidth=r,e.contHeight=H,e.thumbWidth=s,e.thumbHeight=g,e.firstViewIsDone)Y=u,J=f;else{var Z,ee,te=t.getNextImgIndexes(W[u].indexes.page,W[u].indexes.image),ae=t.getPrevImgIndexes(W[f].indexes.page,W[f].indexes.image);if(void 0===t.pagedItems[te.page]||void 0===t.pagedItems[te.page][te.image])return void(t.pN=te.page);if(void 0===t.pagedItems[ae.page]||void 0===t.pagedItems[ae.page][ae.image])return void(t.pN=ae.page);J=(Y=u+1)+1,t.totalcount==t.viewItemsCount+1||e.totalCountIsLess?((Z=angular.copy(t.pagedItems[te.page][te.image])).nId=(new Date).getUTCMilliseconds(),(ee=angular.copy(t.pagedItems[ae.page][ae.image])).nId=(new Date).getUTCMilliseconds()):(Z=t.pagedItems[te.page][te.image],ee=t.pagedItems[ae.page][ae.image]),W.splice(Y,0,Z),W.splice(J,0,ee)}switch(X=Math.PI/2-(O+1)%2*R/2,C=U*(1+Math.cos(X))-_,x=U*(1-Math.sin(X)),V){case 1:y=x*d+(d<0?F:0)-q;break;case 2:case 3:y=x*d+(d<$?L:0)-q;break;case 4:y=x*d-q,(d<0||0<c)&&(y+=F)}switch(W[J].params={x:C,y:y,z:x,scale:0,alpha:X,zIndex:0},W[J].picCSS={width:s+"px",height:g+"px","z-index":"0","-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-moz-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-ms-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-o-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)",transform:"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)"},V){case 1:y=x*c+(c<0?F:0)-q;break;case 2:case 3:y=x*c+(c<$?L:0)-q;break;case 4:y=x*c-q,(c<0||0<d)&&(y+=F)}W[Y].params={x:C,y:y,z:x,scale:0,alpha:X,zIndex:0},W[Y].picCSS={width:s+"px",height:g+"px","z-index":"0","-webkit-transition":"all 0.3s",transition:"all 0.3s","-webkit-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-moz-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-ms-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)","-o-transform:":"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)",transform:"translate3d("+C+"px,"+y+"px,"+x+"px) scale(0.000001)"},e.firstViewIsDone||(W[Y].indexes={page:te.page,image:te.image},W[J].indexes={page:ae.page,image:ae.image},t.viewItemsCount+=2),e.firstViewIsDone=!0,a&&a(e.clickedImageIndexes.local,!0),i&&-1==e.clickedImageIndexes.local&&i(e.scrollToThe)},MasonryVerPositioning:function(e,t,a){var i=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),n=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),r=0,o=e.data.theme.masonry,s=parseInt(o.masonrymargin),g="none"!=o.masonryBorderStyle?2*parseInt(o.masonryBorderWidth):0,h=[],l=[];g+=2*parseInt(o.masonryPadding);var p=Math.round(parseInt(i+s)/(n+g+s));if(n=(i+s-(p=t.pagedItems[t.currentPage].length<p?t.pagedItems[t.currentPage].length:p)*(g+s))/p,0!=p){for(var m=0;m<p;m++)l[m]=[],h[m]=0;for(var c=0;c<t.pagedItems[t.currentPage].length;c++){var d=n*parseInt(t.pagedItems[t.currentPage][c].height)/parseInt(t.pagedItems[t.currentPage][c].width);t.pagedItems[t.currentPage][c].thumbHeight=d,t.pagedItems[t.currentPage][c].thumbWidth=n;var u=Math.min.apply(Math,h),f=h.indexOf(u);h[f]+=d+g+s,l[f].push(t.pagedItems[t.currentPage][c])}var v=Math.max.apply(Math,h),w=h.indexOf(v);r+=h[w]-s;var I=0;for(c=0;c<l.length;c++){var b=0;for(m=0;m<l[c].length;m++)l[c][m].left=I,l[c][m].top=b,b+=l[c][m].thumbHeight+g+s;I+=n+g+s}i=I-s,e.contWidth=i,e.contHeight=r}else e.contHeight=50},MasonryHorPositioning:function(e,t,a){var i,n=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),o=e.data.theme.masonry,s=parseInt(o.masonrymargin),g="none"!=o.masonryBorderStyle?2*parseInt(o.masonryBorderWidth):0,h=[];g+=2*parseInt(o.masonryPadding);for(var l=0,p=0,m=[],c=0;c<t.pagedItems[t.currentPage].length;c++){var d=parseInt(t.pagedItems[t.currentPage][c].height),u=r*(parseInt(t.pagedItems[t.currentPage][c].width)/d);if(t.pagedItems[t.currentPage][c].thumbHeight=r,1<(l+=(t.pagedItems[t.currentPage][c].thumbWidth=u)+(0==c?g:s+g))/n)0!=c&&h.push(m),(m=[]).push(t.pagedItems[t.currentPage][c]),l=u+g;else m.push(t.pagedItems[t.currentPage][c])}if(h.push(m),0!=h.length){var f=0;for(c=0;c<h.length;c++){var v=0;for(p=0;p<h[c].length;p++)h[c][p].left=v,h[c][p].top=f,v+=h[c][p].thumbWidth+s+g;f+=r+s+g}i=f,e.contWidth=n,e.contHeight=i}else e.contHeight=50},MosaicVerPositioning:function(e,t,a){var i,n=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),r=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),o=e.data.theme.mosaic,s=parseInt(o.mosaicMargin),g="none"!=o.mosaicBorderStyle?2*parseInt(o.mosaicBorderWidth):0,h=[],l=[],p=[],m=[],c=1,d=0;g+=2*parseInt(o.mosaicPadding);var u=Math.round(parseInt(n+s)/(r+g+s));if(0!=(u=t.pagedItems[t.currentPage].length<u?t.pagedItems[t.currentPage].length:u)){for(var f=0;f<u;f++)h[f]=[],l[f]=0;for(var v=0;v<t.pagedItems[t.currentPage].length;v++){var w=r*(k=parseInt(t.pagedItems[t.currentPage][v].height))/(A=parseInt(t.pagedItems[t.currentPage][v].width));t.pagedItems[t.currentPage][v].thumbHeight=w,t.pagedItems[t.currentPage][v].thumbWidth=r;var I=Math.min.apply(Math,l),b=l.indexOf(I);l[b]+=w+g+s,h[b].push(t.pagedItems[t.currentPage][v])}for(v=0;v<h.length;v++)for(f=m[v]=0;f<h[v].length;f++)m[v]+=h[v][f].thumbHeight/h[v][f].thumbWidth;var C=h[0].length,y=h.length;for(v=1;v<h.length;v++){var x=h[v].length;c+=m[0]/m[v],d+=(C*g+(C-1)*s-(x*g+(x-1)*s))/m[v]}p[0]=(n-(y*g+(y-1)*s)-d)/c;for(v=1;v<m.length;v++){x=h[v].length;p[v]=(p[0]*m[0]+C*g+(C-1)*s-(x*g+(x-1)*s))/m[v]}var P=0;for(v=0;v<h.length;v++){var S=0;for(f=0;f<h[v].length;f++){var k=parseInt(h[v][f].height),A=parseInt(h[v][f].width);w=p[v]*k/A;h[v][f].thumbWidth=p[v],h[v][f].thumbHeight=w,h[v][f].left=P,h[v][f].top=S,S+=w+g+s}P+=p[v]+g+s}i=S-s,e.contWidth=n,e.contHeight=i}else e.contHeight=50},MosaicHorPositioning:function(e,t,a){var i,n,r,o=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),s=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),g=e.data.theme.mosaic,h=parseInt(g.mosaicMargin),l="none"!=g.mosaicBorderStyle?2*parseInt(g.mosaicBorderWidth):0,p=2*parseInt(g.mosaicPadding),m=(parseInt(e.shatts.contwidth),[]),c=[];l+=p;for(var d=0,u=0,f=[],v=0;v<t.pagedItems[t.currentPage].length;v++){var w=parseInt(t.pagedItems[t.currentPage][v].height),I=s*(parseInt(t.pagedItems[t.currentPage][v].width)/w);if(t.pagedItems[t.currentPage][v].thumbHeight=s,1<(d+=(t.pagedItems[t.currentPage][v].thumbWidth=I)+(0==v?l:h+l))/o&&v!=t.pagedItems[t.currentPage].length-1)0!=v&&m.push(f),(f=[]).push(t.pagedItems[t.currentPage][v]),d=I+l;else f.push(t.pagedItems[t.currentPage][v])}if(m.push(f),0!=(n=m.length)){if(1<n){if(r=m[n-1],nearLast=m[n-2],2<=nearLast.length/r.length)for(;0!=m[n-1].length;)m[n-2].push(m[n-1].pop());0==m[n-1].length&&m.pop()}for(v=0;v<m.length;v++){var b=0;for(u=0;u<m[v].length;u++)b+=m[v][u].thumbWidth/m[v][u].thumbHeight;c.push((o-((u-1)*h+u*l))/b)}var C=0;for(v=0;v<m.length;v++){var y=0;for(u=0;u<m[v].length;u++){var x=c[v]*(m[v][u].width/m[v][u].height);m[v][u].thumbWidth=x,m[v][u].thumbHeight=c[v],m[v][u].left=y,m[v][u].top=C,y+=x+h+l}C+=c[v]+h+l}i=C,e.contWidth=o,e.contHeight=i}else e.contHeight=50},MosaicRandPositioning:function(e,t,a){var F=jQuery("#grsGal"+e.grs).parent().width()*((void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth))/100),L=0,i=void 0===e.albumView||void 0!==e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),n=e.data.theme.mosaic,$=parseInt(n.mosaicMargin),G="none"!=n.mosaicBorderStyle?2*parseInt(n.mosaicBorderWidth):0,r=2*parseInt(n.mosaicPadding);if(G+=r,!1===e.prevContWidth)e.prevContWidth=F,e.prevLoadedCount=t.loadedCount,e.prevCP=t.currentPage;else if(e.prevContWidth==F){if(e.prevLoadedCount==t.loadedCount&&e.prevCP==t.currentPage)return;e.prevLoadedCount=t.loadedCount,e.prevCP=t.currentPage}else e.prevContWidth=F;if(0!=t.pagedItems[t.currentPage].length){var o,s,g,h=function(e){var t,a,i=0,n=0,r=[];for(t=0;t<e.length;t++){for(a=r[t]=0;a<e[t].length;a++)r[t]+=e[t][a].height/e[t][a].width;i+=1/r[t],n+=((e[t].length-1)*$+e[t].length*G)/r[t]}var o,s,g=(F+n-(e.length-1)*$-e.length*G)/i,h=0;for(t=0;t<e.length;t++){for(o=(g-(e[t].length-1)*$-e[t].length*G)/r[t],a=s=0;a<e[t].length;a++)e[t][a].thumbWidth=o,e[t][a].thumbHeight=o*e[t][a].height/e[t][a].width,e[t][a].top=L+s,e[t][a].left=h,s+=e[t][a].thumbHeight+$+G;h+=o+$+G}return g},l=function(e){var t,a,i=0,n=0,r=[];for(t=0;t<e.length;t++){for(a=r[t]=0;a<e[t].length;a++)r[t]+=e[t][a].width/e[t][a].height;i+=1/r[t],n+=((e[t].length-1)*$+e[t].length*G)/r[t]}var o,s,g=F*i-n+(e.length-1)*$+e.length*G,h=0;for(t=0;t<e.length;t++){for(s=(F-(e[t].length-1)*$-e[t].length*G)/r[t],a=o=0;a<e[t].length;a++)e[t][a].thumbHeight=s,e[t][a].thumbWidth=s*e[t][a].width/e[t][a].height,e[t][a].top=L+h,e[t][a].left=o,o+=e[t][a].thumbWidth+$+G;h+=s+$+G}return g},p=function(e,t){var a=0;if(1==e.length)a="ver"==t.groupsInfo[0].gType?h(e[0]):l(e[0]);else if(2==e.length){var i="Left"!=t.addMethods[1];if("Bottom"==t.addMethods[1])a="ver"==t.groupsInfo[0].gType?h(e[0]):l(e[0]),L+=a+$,a="ver"==t.groupsInfo[1].gType?h(e[1]):l(e[1]);else if(t.groupsInfo[0].gType==t.groupsInfo[1].gType)"ver"==t.groupsInfo[0].gType?a=function(e,t,a){var i,n,r=0,o=0,s=[];for(i=0;i<e.length;i++){for(n=s[i]=0;n<e[i].length;n++)s[i]+=e[i][n].height/e[i][n].width;r+=1/s[i],o+=((e[i].length-1)*$+e[i].length*G)/s[i]}var g=0,h=0,l=[];for(i=0;i<t.length;i++){for(n=l[i]=0;n<t[i].length;n++)l[i]+=t[i][n].height/t[i][n].width;g+=1/l[i],h+=((t[i].length-1)*$+t[i].length*G)/l[i]}var p=(F-$+o+h-(e.length+t.length-2)*$-(e.length+t.length)*G)/(r+g),m=p*r-o+(e.length-1)*$+e.length*G,c=p*g-h+(t.length-1)*$+t.length*G,d=0,u=0;a?u=m+$:d=c+$;var f,v,w=0;for(i=0;i<e.length;i++){for(f=(p-(e[i].length-1)*$-e[i].length*G)/s[i],n=v=0;n<e[i].length;n++)e[i][n].thumbWidth=f,e[i][n].thumbHeight=f*e[i][n].height/e[i][n].width,e[i][n].top=L+v,e[i][n].left=d+w,v+=e[i][n].thumbHeight+$+G;w+=f+$+G}for(i=w=0;i<t.length;i++){for(f=(p-(t[i].length-1)*$-t[i].length*G)/l[i],n=v=0;n<t[i].length;n++)t[i][n].thumbWidth=f,t[i][n].thumbHeight=f*t[i][n].height/t[i][n].width,t[i][n].top=L+v,t[i][n].left=u+w,v+=t[i][n].thumbHeight+$+G;w+=f+$+G}return p}(e[0],e[1],i):"hor"==t.groupsInfo[0].gType?a=function(e,t,a){var i,n,r=0,o=0,s=[];for(i=0;i<e.length;i++){for(n=s[i]=0;n<e[i].length;n++)s[i]+=e[i][n].width/e[i][n].height;r+=1/s[i],o+=((e[i].length-1)*$+e[i].length*G)/s[i]}var g=0,h=0,l=[];for(i=0;i<t.length;i++){for(n=l[i]=0;n<t[i].length;n++)l[i]+=t[i][n].width/t[i][n].height;g+=1/l[i],h+=((t[i].length-1)*$+t[i].length*G)/l[i]}var p=(F-$-o/r-h/g+((e.length-1)/r+(t.length-1)/g)*$+(e.length/r+t.length/g)*G)/(1/r+1/g),m=(p+o-(e.length-1)*$-e.length*G)/r,c=(p+h-(t.length-1)*$-t.length*G)/g,d=0,u=0;a?u=m+$:d=c+$;var f,v,w=0;for(i=0;i<e.length;i++){for(v=(m-(e[i].length-1)*$-e[i].length*G)/s[i],n=f=0;n<e[i].length;n++)e[i][n].thumbHeight=v,e[i][n].thumbWidth=v*e[i][n].width/e[i][n].height,e[i][n].top=L+w,e[i][n].left=d+f,f+=e[i][n].thumbWidth+$+G;w+=v+$+G}for(i=w=0;i<t.length;i++){for(v=(c-(t[i].length-1)*$-t[i].length*G)/l[i],n=f=0;n<t[i].length;n++)t[i][n].thumbHeight=v,t[i][n].thumbWidth=v*t[i][n].width/t[i][n].height,t[i][n].top=L+w,t[i][n].left=u+f,f+=t[i][n].thumbWidth+$+G;w+=v+$+G}return p}(e[0],e[1],i):O.log("LG**Groups have wrong types.");else{if("ver"==t.groupsInfo[0].gType)r=e[0],o=e[1];else{if("hor"!=t.groupsInfo[0].gType)return O.log("LG**Groups have wrong types!!!!!!!!"),a;r=e[1],o=e[0]}a=function(e,t,a){var i,n,r=0,o=0,s=[];for(i=0;i<e.length;i++){for(n=s[i]=0;n<e[i].length;n++)s[i]+=e[i][n].height/e[i][n].width;r+=1/s[i],o+=((e[i].length-1)*$+e[i].length*G)/s[i]}var g=0,h=0,l=[];for(i=0;i<t.length;i++){for(n=l[i]=0;n<t[i].length;n++)l[i]+=t[i][n].width/t[i][n].height;g+=1/l[i],h+=((t[i].length-1)*$+t[i].length*G)/l[i]}var p=(F-$+o-(e.length-1)*$-e.length*G-(h-(t.length-1)*$-t.length*G)/g)/(r+1/g),m=p*r-o+(e.length-1)*$+e.length*G,c=(p+h-(t.length-1)*$-t.length*G)/g,d=0,u=0;a?u=m+$:d=c+$;var f,v,w=0;for(i=0;i<e.length;i++){for(f=(p-(e[i].length-1)*$-e[i].length*G)/s[i],n=v=0;n<e[i].length;n++)e[i][n].thumbWidth=f,e[i][n].thumbHeight=f*e[i][n].height/e[i][n].width,e[i][n].top=L+v,e[i][n].left=d+w,v+=e[i][n].thumbHeight+$+G;w+=f+$+G}var I,b,C=0;for(i=0;i<t.length;i++){for(I=(c-(t[i].length-1)*$-t[i].length*G)/l[i],n=b=0;n<t[i].length;n++)t[i][n].thumbHeight=I,t[i][n].thumbWidth=I*t[i][n].width/t[i][n].height,t[i][n].top=L+C,t[i][n].left=u+b,b+=t[i][n].thumbWidth+$+G;C+=I+$+G}return p}(r,o,i)}}else if(3==e.length){var n="Right"==t.addMethods[2];if(t.groupsInfo[0].gType==t.groupsInfo[1].gType)"ver"==t.groupsInfo[0].gType?"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].height/e[r][o].width;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].height/t[r][o].width;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].height/a[r][o].width;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=(p-g+(e.length-t.length)*($+G))/l,v=(F-$+g+d-(f+$)*c-(e.length+a.length-2)*$-(e.length+a.length)*G)/(s+c+s*c/l),w=v*s/l+f,I=v+w+$,b=v*s-g+(e.length-1)*$+e.length*G,C=I*c-d+(a.length-1)*$+a.length*G,y=0,x=0;i?x=v+$:y=w+$;var P=0,S=0;n?S=b+$:P=C+$;var k,A,T=0;for(r=0;r<e.length;r++){for(k=(v-(e[r].length-1)*$-e[r].length*G)/h[r],o=A=0;o<e[r].length;o++)e[r][o].thumbWidth=k,e[r][o].thumbHeight=k*e[r][o].height/e[r][o].width,e[r][o].top=L+y+A,e[r][o].left=P+T,A+=e[r][o].thumbHeight+$+G;T+=k+$+G}for(r=T=0;r<t.length;r++){for(k=(w-(t[r].length-1)*$-t[r].length*G)/m[r],o=A=0;o<t[r].length;o++)t[r][o].thumbWidth=k,t[r][o].thumbHeight=k*t[r][o].height/t[r][o].width,t[r][o].top=L+x+A,t[r][o].left=P+T,A+=t[r][o].thumbHeight+$+G;T+=k+$+G}for(r=T=0;r<a.length;r++){for(k=(I-(a[r].length-1)*$-a[r].length*G)/u[r],o=A=0;o<a[r].length;o++)a[r][o].thumbWidth=k,a[r][o].thumbHeight=k*a[r][o].height/a[r][o].width,a[r][o].top=L+A,a[r][o].left=S+T,A+=a[r][o].thumbHeight+$+G;T+=k+$+G}return I}(e[0],e[1],e[2],!0,n):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].height/e[r][o].width;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].height/t[r][o].width;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].width/a[r][o].height;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=(p-g+(e.length-t.length)*($+G))/l,v=(F-$-(f+d)/c+g+((a.length-2)*$+a.length*G)/c-(e.length-1)*$-e.length*G)/(1/c+s+s/(l*c)),w=v*s/l+f,I=v*s-g+(e.length-1)*$+e.length*G,b=(v+w+d-(a.length-2)*$-a.length*G)/c,C=0,y=0;i?y=v+$:C=w+$;var x=0,P=0;n?P=I+$:x=b+$;var S,k,A=0;for(r=0;r<e.length;r++){for(S=(v-(e[r].length-1)*$-e[r].length*G)/h[r],o=k=0;o<e[r].length;o++)e[r][o].thumbWidth=S,e[r][o].thumbHeight=S*e[r][o].height/e[r][o].width,e[r][o].top=L+C+k,e[r][o].left=x+A,k+=e[r][o].thumbHeight+$+G;A+=S+$+G}for(r=A=0;r<t.length;r++){for(S=(w-(t[r].length-1)*$-t[r].length*G)/m[r],o=k=0;o<t[r].length;o++)t[r][o].thumbWidth=S,t[r][o].thumbHeight=S*t[r][o].height/t[r][o].width,t[r][o].top=L+y+k,t[r][o].left=x+A,k+=t[r][o].thumbHeight+$+G;A+=S+$+G}var T,E,M=0;for(r=0;r<a.length;r++){for(T=(b-(a[r].length-1)*$-a[r].length*G)/u[r],o=E=0;o<a[r].length;o++)a[r][o].thumbHeight=T,a[r][o].thumbWidth=T*a[r][o].width/a[r][o].height,a[r][o].top=L+M,a[r][o].left=P+E,E+=a[r][o].thumbWidth+$+G;M+=T+$+G}return v+w+$}(e[0],e[1],e[2],!0,n):O.log("LG**Groups have wrong types!!!!!!!!"):"hor"==t.groupsInfo[0].gType?"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].width/e[r][o].height;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].width/t[r][o].height;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].height/a[r][o].width;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=(g-(e.length-1)*$-e.length*G)/s,v=(p-(t.length-1)*$-t.length*G)/l,w=(F-$-(f-v)*l*c-c*$+d-f-(a.length-1)*$-a.length*G)/(1/s+c+l*c/s),I=w*l/s+(f-v)*l,b=w+I+$,C=w/s+f,y=b*c-d+(a.length-1)*$+a.length*G,x=0,P=0;i?P=w+$:x=I+$;var S=0,k=0;n?k=C+$:S=y+$;var A,T,E=0;for(r=0;r<e.length;r++){for(A=(C-(e[r].length-1)*$-e[r].length*G)/h[r],o=T=0;o<e[r].length;o++)e[r][o].thumbHeight=A,e[r][o].thumbWidth=A*e[r][o].width/e[r][o].height,e[r][o].top=L+x+E,e[r][o].left=S+T,T+=e[r][o].thumbWidth+$+G;E+=A+$+G}for(r=E=0;r<t.length;r++){for(A=(C-(t[r].length-1)*$-t[r].length*G)/m[r],o=T=0;o<t[r].length;o++)t[r][o].thumbHeight=A,t[r][o].thumbWidth=A*t[r][o].width/t[r][o].height,t[r][o].top=L+P+E,t[r][o].left=S+T,T+=t[r][o].thumbWidth+$+G;E+=A+$+G}var M,H,V=0;for(r=0;r<a.length;r++){for(M=(b-(a[r].length-1)*$-a[r].length*G)/u[r],o=H=0;o<a[r].length;o++)a[r][o].thumbWidth=M,a[r][o].thumbHeight=M*a[r][o].height/a[r][o].width,a[r][o].top=L+H,a[r][o].left=k+V,H+=a[r][o].thumbHeight+$+G;V+=M+$+G}return b}(e[0],e[1],e[2],!0,n):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].width/e[r][o].height;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].width/t[r][o].height;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].width/a[r][o].height;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=(g-(e.length-1)*$-e.length*G)/s,v=(p-(t.length-1)*$-t.length*G)/l,w=(d-(a.length-2)*$-a.length*G)/c,I=(F-$-f-w-(f-v)*l/c)/(1/s+1/c+l/(c*s)),b=I*l/s+(f-v)*l,C=I+b+$,y=I/s+f,x=(I+b)/c+w,P=0,S=0;i?S=I+$:P=b+$;var k=0,A=0;n?A=y+$:k=x+$;var T,E,M=0;for(r=0;r<e.length;r++){for(T=(y-(e[r].length-1)*$-e[r].length*G)/h[r],o=E=0;o<e[r].length;o++)e[r][o].thumbHeight=T,e[r][o].thumbWidth=T*e[r][o].width/e[r][o].height,e[r][o].top=L+P+M,e[r][o].left=k+E,E+=e[r][o].thumbWidth+$+G;M+=T+$+G}for(r=M=0;r<t.length;r++){for(T=(y-(t[r].length-1)*$-t[r].length*G)/m[r],o=E=0;o<t[r].length;o++)t[r][o].thumbHeight=T,t[r][o].thumbWidth=T*t[r][o].width/t[r][o].height,t[r][o].top=L+S+M,t[r][o].left=k+E,E+=t[r][o].thumbWidth+$+G;M+=T+$+G}for(r=M=0;r<a.length;r++){for(T=(x-(a[r].length-1)*$-a[r].length*G)/u[r],o=E=0;o<a[r].length;o++)a[r][o].thumbHeight=T,a[r][o].thumbWidth=T*a[r][o].width/a[r][o].height,a[r][o].top=L+M,a[r][o].left=A+E,E+=a[r][o].thumbWidth+$+G;M+=T+$+G}return C}(e[0],e[1],e[2],!0,n):O.log("LG**Groups have wrong types!!!!!!!!"):O.log("LG**Groups have wrong types!!!!!!!!");else{var r,o,s;if("ver"==t.groupsInfo[0].gType&&"hor"==t.groupsInfo[1].gType)r=e[0],o=e[1],s=!0;else{if("hor"!=t.groupsInfo[0].gType||"ver"!=t.groupsInfo[1].gType)return O.log("LG**Groups have wrong types!!!!!!!!"),a;r=e[1],o=e[0],s=!1}"ver"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].height/e[r][o].width;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].width/t[r][o].height;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].height/a[r][o].width;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=(F-$+g-(e.length-1)*$-e.length*G-c*$+d-(a.length-1)*$-a.length*G)*c/(s+c),v=(F-$-f+((t.length-1)*$+t.length*G-p)/l-c*$+d-(a.length-1)*$-a.length*G)/(1/l+c-c*c/(s+c)),w=(f-v*c*c/(s+c))/c,I=w+v+$,b=w*s-g+(e.length-1)*$+e.length*G,C=I*c-d+(a.length-1)*$+a.length*G,y=0,x=0;i?x=w+$:y=v+$;var P=0,S=0;n?S=b+$:P=C+$;var k,A,T=0;for(r=0;r<e.length;r++){for(k=(w-(e[r].length-1)*$-e[r].length*G)/h[r],o=A=0;o<e[r].length;o++)e[r][o].thumbWidth=k,e[r][o].thumbHeight=k*e[r][o].height/e[r][o].width,e[r][o].top=L+y+A,e[r][o].left=P+T,A+=e[r][o].thumbHeight+$+G;T+=k+$+G}var E,M,H=0;for(r=0;r<t.length;r++){for(E=(b-(t[r].length-1)*$-t[r].length*G)/m[r],o=M=0;o<t[r].length;o++)t[r][o].thumbHeight=E,t[r][o].thumbWidth=E*t[r][o].width/t[r][o].height,t[r][o].top=L+x+H,t[r][o].left=P+M,M+=t[r][o].thumbWidth+$+G;H+=E+$+G}for(r=T=0;r<a.length;r++){for(k=(I-(a[r].length-1)*$-a[r].length*G)/u[r],o=A=0;o<a[r].length;o++)a[r][o].thumbWidth=k,a[r][o].thumbHeight=k*a[r][o].height/a[r][o].width,a[r][o].top=L+A,a[r][o].left=S+T,A+=a[r][o].thumbHeight+$+G;T+=k+$+G}return I}(r,o,e[2],s,n):"hor"==t.groupsInfo[2].gType?a=function(e,t,a,i,n){var r,o,s=0,g=0,h=[];for(r=0;r<e.length;r++){for(o=h[r]=0;o<e[r].length;o++)h[r]+=e[r][o].height/e[r][o].width;s+=1/h[r],g+=((e[r].length-1)*$+e[r].length*G)/h[r]}var l=0,p=0,m=[];for(r=0;r<t.length;r++){for(o=m[r]=0;o<t[r].length;o++)m[r]+=t[r][o].width/t[r][o].height;l+=1/m[r],p+=((t[r].length-1)*$+t[r].length*G)/m[r]}var c=0,d=0,u=[];for(r=0;r<a.length;r++){for(o=u[r]=0;o<a[r].length;o++)u[r]+=a[r][o].width/a[r][o].height;c+=1/u[r],d+=((a[r].length-1)*$+a[r].length*G)/u[r]}var f=l*((e.length-1)*$+e.length*G-g)-p+(t.length-1)*$+t.length*G,v=(F-$+g-(e.length-1)*$-e.length*G-(f+d-(a.length-2)*$-a.length*G)/c)/(s+1/c+s*l/c),w=v*s*l+f,I=v+w+$,b=v*s-g+(e.length-1)*$+e.length*G,C=(I+d-(a.length-1)*$-a.length*G)/c,y=0,x=0;i?x=v+$:y=w+$;var P=0,S=0;n?S=b+$:P=C+$;var k,A,T=0;for(r=0;r<e.length;r++){for(k=(v-(e[r].length-1)*$-e[r].length*G)/h[r],o=A=0;o<e[r].length;o++)e[r][o].thumbWidth=k,e[r][o].thumbHeight=k*e[r][o].height/e[r][o].width,e[r][o].top=L+y+A,e[r][o].left=P+T,A+=e[r][o].thumbHeight+$+G;T+=k+$+G}var E,M,H=0;for(r=0;r<t.length;r++){for(E=(b-(t[r].length-1)*$-t[r].length*G)/m[r],o=M=0;o<t[r].length;o++)t[r][o].thumbHeight=E,t[r][o].thumbWidth=E*t[r][o].width/t[r][o].height,t[r][o].top=L+x+H,t[r][o].left=P+M,M+=t[r][o].thumbWidth+$+G;H+=E+$+G}for(r=H=0;r<a.length;r++){for(E=(C-(a[r].length-1)*$-a[r].length*G)/u[r],o=M=0;o<a[r].length;o++)a[r][o].thumbHeight=E,a[r][o].thumbWidth=E*a[r][o].width/a[r][o].height,a[r][o].top=L+H,a[r][o].left=S+M,M+=a[r][o].thumbWidth+$+G;H+=E+$+G}return I}(r,o,e[2],s,n):O.log("LG**Groups have wrong types!!!!!!!!")}}else O.log("LG**Wrong groups count!!!!!!!!");return a},m={Top:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbWidth=0<t.currentLength?t.width:a.width,a.thumbHeight=a.height*a.thumbWidth/a.width;var n=t.width,r=t.height;0==t.currentLength&&(n=a.thumbWidth),r+=a.thumbHeight,1<g&&n/r<=d&&!i?this.Right(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Top",0==t.currentLength?(e.push([a]),t.gType="ver"):1==t.currentLength?(e[0].splice(0,0,a),t.gType="ver"):"Right"==t.addMethods[t.addMethods.length-1]||"Left"==t.addMethods[t.addMethods.length-1]?(e.splice(0,0,[a]),t.gType="hor"):(e[0].splice(0,0,a),t.gType="ver"),t.currentLength++,t.addMethods.push("Top"))},Right:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbHeight=0<t.currentLength?t.height:a.height,a.thumbWidth=a.width*a.thumbHeight/a.height;var n=t.width,r=t.height;0==t.currentLength&&(r=a.thumbHeight),n+=a.thumbWidth,1<g&&u<=n/r&&!i?this.Bottom(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Right",0==t.currentLength?(e.push([a]),t.gType="hor"):1==t.currentLength?(e[0].push(a),t.gType="hor"):"Top"==t.addMethods[t.addMethods.length-1]||"Bottom"==t.addMethods[t.addMethods.length-1]?(e.push([a]),t.gType="ver"):(e[0].push(a),t.gType="hor"),t.currentLength++,t.addMethods.push("Right"))},Bottom:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbWidth=0<t.currentLength?t.width:a.width,a.thumbHeight=a.height*a.thumbWidth/a.width;var n=t.width,r=t.height;0==t.currentLength&&(n=a.thumbWidth),r+=a.thumbHeight,1<g&&n/r<=d&&!i?this.Right(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Bottom",0==t.currentLength?(e.push([a]),t.gType="ver"):1==t.currentLength?(e[0].push(a),t.gType="ver"):"Right"==t.addMethods[t.addMethods.length-1]||"Left"==t.addMethods[t.addMethods.length-1]?(e.push([a]),t.gType="hor"):(e[0].push(a),t.gType="ver"),t.currentLength++,t.addMethods.push("Bottom"))},Left:function(e,t,a,i){a.width=parseInt(a.width),a.height=parseInt(a.height),a.thumbHeight=0<t.currentLength?t.height:a.height,a.thumbWidth=a.width*a.thumbHeight/a.height;var n=t.width,r=t.height;0==t.currentLength&&(r=a.thumbHeight),n+=a.thumbWidth,1<g&&u<=n/r&&!i?this.Bottom(e,t,a,!0):(t.width=n,t.height=r,a.addedFrom="Left",0==t.currentLength?(e.push([a]),t.gType="hor"):1==t.currentLength?(e[0].splice(0,0,a),t.gType="hor"):"Top"==t.addMethods[t.addMethods.length-1]||"Bottom"==t.addMethods[t.addMethods.length-1]?(e.splice(0,0,[a]),t.gType="ver"):(e[0].splice(0,0,a),t.gType="hor"),t.currentLength++,t.addMethods.push("Left"))}},c={Right:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.width+=a.width*t.height/a.height,e.push(i),t.addMethods.push("Right"),t.groupsInfo.push(a)},Bottom:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.height+=a.height*t.width/a.width,e.push(i),t.addMethods.push("Bottom"),t.groupsInfo.push(a)},Left:function(e,t,a,i){e.length<1?(t.width=a.width,t.height=a.height):t.width+=a.width*t.height/a.height,e.push(i),t.addMethods.push("Left"),t.groupsInfo.push(a)}},d=.6,u=1.8,f=["Top","Right","Bottom","Left"];s=F-G<=i?(g=1,f=["Bottom"],o=t.pagedItems[t.currentPage].length,1):(F-3*$-4*G)/4<=i?(o=g=2,0):(F-4*$-5*G)/5<=i?(g=3,o=2,1):(g=4,o=3,0);var v,w,I,b,C,y,x,P,S=[],k=[],A=[];for(w=0;w<t.pagedItems[t.currentPage].length;w++)0==S.length&&(w+(x=o+Math.round(Math.random()*s))==t.pagedItems[t.currentPage].length-1&&(x=2<x?x-1:x+1),v={width:0,height:0,currentLength:0,gType:"none",addMethods:[]}),I=(y=t.pagedItems[t.currentPage][w]).width/y.height,b=v.width/v.height,P=!0,1<g&&(I<=d||b<=d)?C=Math.random()<=.5?"Right":"Left":1<g&&(u<=I||u<=b)?C=Math.random()<=.5?"Bottom":"Top":(C=f[Math.round(Math.random()*(f.length-1))],P=!1),m[C](S,v,y,P),v.currentLength!=x&&w+1!=t.pagedItems[t.currentPage].length||(k.push(S),S=[],A.push(v));var T,E,M=[],H=[],V=[],W="";for(w=0;w<k.length;w++)0==M.length&&(T={width:0,height:0,needLength:2,isSpecGroup:!1,addMethods:[],groupsInfo:[]},2<g&&k.length-w<=4&&(T.needLength=k.length-w==4?2:k.length-w,T.isSpecGroup=!0)),y=k[w],itemInfo=A[w],Math.round(Math.random()*(f.length-1)),I=itemInfo.width/itemInfo.height,b=T.width/T.height,c[C=""!=W?W:1<g&&u<=I&&u<=b?"Bottom":Math.random()<=.5?"Right":"Left"](M,T,itemInfo,y),T.isSpecGroup?W=T.needLength-M.length==2?"Bottom":T.needLength-M.length==1?Math.random()<=.5?"Right":"Left":"":2<g&&"Bottom"==C&&w+1<k.length&&A[w+1].width/A[w+1].height<u?(W=Math.random()<=.5?"Right":"Left",T.needLength++):W="",(M.length>=T.needLength||w+1>=k.length)&&(H.push(M),M=[],V.push(T));for(w=0;w<H.length;w++)E=p(H[w],V[w]),L+=E+$;e.contWidth=F,e.contHeight=0<L?L-$:0}else e.contHeight=50}}}]);